<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ูุธุงู ุชุดุบูู ุงูุดูู</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="_sdk/data_sdk.js"></script>
  <script src="_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 600;
    }
    
    .tab-button {
      padding: 0.75rem 1.5rem;
      border: none;
      background: transparent;
      cursor: pointer;
      font-weight: 600;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }
    
    .tab-button.active {
      border-bottom-color: currentColor;
    }
    
    .card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 1rem;
    }
    
    .stat-card {
      text-align: center;
      padding: 1.5rem;
      border-radius: 12px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .stat-number {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 0.5rem 0;
    }
    
    .stat-label {
      font-size: 0.875rem;
      opacity: 0.7;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #3b82f6;
    }
    
    button {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      border: none;
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-primary {
      background: #3b82f6;
      color: white;
    }
    
    .btn-primary:hover:not(:disabled) {
      background: #2563eb;
    }
    
    .btn-secondary {
      background: #6b7280;
      color: white;
    }
    
    .btn-secondary:hover:not(:disabled) {
      background: #4b5563;
    }
    
    .btn-success {
      background: #10b981;
      color: white;
    }
    
    .btn-success:hover:not(:disabled) {
      background: #059669;
    }
    
    .btn-danger {
      background: #ef4444;
      color: white;
    }
    
    .btn-danger:hover:not(:disabled) {
      background: #dc2626;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 90%;
      overflow-y: auto;
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .checkbox-group input[type="checkbox"] {
      width: auto;
    }
    
    .table-container {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 12px;
      overflow: hidden;
    }
    
    th {
      background: #f3f4f6;
      padding: 1rem;
      text-align: right;
      font-weight: 600;
    }
    
    td {
      padding: 1rem;
      border-top: 1px solid #e5e7eb;
    }
    
    tr:hover {
      background: #f9fafb;
    }
    
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
    
    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: #1f2937;
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 2000;
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full">
  <!-- Login Screen -->
  <div id="login-screen" style="display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
   <div style="background: white; padding: 3rem; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); max-width: 400px; width: 90%;">
    <h2 style="font-size: 2rem; font-weight: bold; text-align: center; margin-bottom: 0.5rem; color: #1f2937;">ูุธุงู ุชุดุบูู ุงูุดูู</h2>
    <p style="text-align: center; color: #6b7280; margin-bottom: 2rem;">ุชุณุฌูู ุงูุฏุฎูู</p>
    <form id="login-form" onsubmit="handleLogin(event)" style="display: flex; flex-direction: column; gap: 1.5rem;">
     <div class="form-group">
      <label for="login-username" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">ุงุณู ุงููุณุชุฎุฏู</label>
      <input type="text" id="login-username" required style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s;" placeholder="ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู">
     </div>
     <div class="form-group">
      <label for="login-password" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">ูููุฉ ุงููุฑูุฑ</label>
      <input type="password" id="login-password" required style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s;" placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ">
     </div>
     <div id="login-error" style="display: none; padding: 0.75rem; background: #fee2e2; color: #991b1b; border-radius: 8px; text-align: center; font-size: 0.875rem;"></div>
     <button type="submit" class="btn-primary" style="width: 100%; padding: 0.875rem; font-size: 1rem; font-weight: 600; cursor: pointer;">ุชุณุฌูู ุงูุฏุฎูู</button>
    </form>
   </div>
  </div>
  
  <!-- Main Application (Hidden until login) -->
  <div id="app" class="h-full w-full" style="background: #f3f4f6; overflow-y: auto; display: none;"><!-- Header -->
   <header style="background: #1f2937; color: white; padding: 1.5rem 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center;">
    <div>
     <h1 id="system-title" style="font-size: 1.875rem; font-weight: bold; margin: 0;">ูุธุงู ุชุดุบูู ุงูุดูู</h1>
     <p style="opacity: 0.8; margin-top: 0.25rem;">ุฅุฏุงุฑุฉ ูุชูุงููุฉ ููููุงูุน ุงูุฎูุณุฉ</p>
    </div>
    <button onclick="handleLogout()" class="btn-secondary" style="padding: 0.75rem 1.5rem; font-size: 0.875rem; cursor: pointer;">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
   </header><!-- Navigation Tabs -->
   <nav style="background: white; padding: 0 2rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;"><button class="tab-button active" data-tab="dashboard" style="color: #3b82f6;"> ููุญุฉ ุงูุชุญูู </button> <button class="tab-button" data-tab="bookings" style="color: #6b7280;"> ุงูุญุฌูุฒุงุช </button> <button class="tab-button" data-tab="delivery" style="color: #6b7280;"> ุงูุชูุตูู </button> <button class="tab-button" data-tab="units" style="color: #6b7280;"> ุงูุดูู </button> <button class="tab-button" data-tab="cleaning" style="color: #6b7280;"> ุงูุชูุธูู </button> <button class="tab-button" data-tab="inspection" style="color: #6b7280;"> ุงูุชูุชูุด </button> <button class="tab-button" data-tab="inventory" style="color: #6b7280;"> ุงููุณุชูุฒูุงุช </button> <button class="tab-button" data-tab="maintenance" style="color: #6b7280;"> ุงูุตูุงูุฉ </button> <button class="tab-button" data-tab="invoices" style="color: #6b7280;"> ุงูููุงุชูุฑ </button> <button class="tab-button" data-tab="pos" style="color: #6b7280;"> ๐ณ ุงูุฏูุนุงุช </button>
    </div>
   </nav><!-- Main Content -->
   <main style="padding: 2rem; max-width: 1400px; margin: 0 auto;"><!-- Dashboard Tab -->
    <div id="dashboard-tab" class="tab-content">
     <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
      <div class="stat-card">
       <div class="stat-label">
        ุดูู ุฌุงูุฒุฉ
       </div>
       <div class="stat-number" id="ready-count" style="color: #10b981;">
        0
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-label">
        ุชุญุชุงุฌ ุชูุธูู
       </div>
       <div class="stat-number" id="cleaning-count" style="color: #ef4444;">
        0
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-label">
        ุฏุฎูู ุงูููู
       </div>
       <div class="stat-number" id="checkin-count" style="color: #3b82f6;">
        0
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-label">
        ุฎุฑูุฌ ุงูููู
       </div>
       <div class="stat-number" id="checkout-count" style="color: #f59e0b;">
        0
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-label">
        ููุงู ุชูุธูู
       </div>
       <div class="stat-number" id="tasks-count" style="color: #8b5cf6;">
        0
       </div>
      </div>
     </div>
     <div class="card">
      <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">ุญุฌูุฒุงุช ุงูููู</h2>
      <div id="today-bookings" style="min-height: 100px;"></div>
     </div>
     <div class="card">
      <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">ููุงูุต ุงููุณุชูุฒูุงุช</h2>
      <div id="low-inventory" style="min-height: 100px;"></div>
     </div>
    </div><!-- Bookings Tab -->
    <div id="bookings-tab" class="tab-content" style="display: none;">
     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
      <h2 style="font-size: 1.5rem; font-weight: bold;">ุฅุฏุงุฑุฉ ุงูุญุฌูุฒุงุช</h2><button class="btn-primary" onclick="openBookingModal()">+ ุญุฌุฒ ุฌุฏูุฏ</button>
     </div>
     <div class="card">
      <div class="table-container">
       <table id="bookings-table">
        <thead>
         <tr>
          <th>ุงููููุน</th>
          <th>ุฑูู ุงูุดูุฉ</th>
          <th>ุงููุณุชุฃุฌุฑ</th>
          <th>ุงููุงุชู</th>
          <th>ุชุงุฑูุฎ ุงูุฏุฎูู</th>
          <th>ุชุงุฑูุฎ ุงูุฎุฑูุฌ</th>
          <th>ุงูุถููู</th>
          <th>ุงูุนููุงู</th>
          <th>ุงูุญุงูุฉ</th>
          <th>ุฅุฌุฑุงุกุงุช</th>
         </tr>
        </thead>
        <tbody id="bookings-body"></tbody>
       </table>
      </div>
     </div>
    </div><!-- Units Tab -->
    <div id="units-tab" class="tab-content" style="display: none;">
     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
      <div>
       <h2 style="font-size: 1.5rem; font-weight: bold; margin: 0;">ุฅุฏุงุฑุฉ ุงูุดูู</h2>
       <p style="margin: 0.5rem 0 0 0; color: #6b7280; font-size: 1rem;">ุฅุฌูุงูู ุงูุดูู: <strong id="total-units-count" style="color: #3b82f6; font-size: 1.125rem;">0</strong></p>
      </div>
      <div style="display: flex; gap: 1rem;">
       <button class="btn-success" onclick="importAllProperties()">๐ฅ ุงุณุชูุฑุงุฏ ุฌููุน ุงูุนูุงุฑุงุช</button>
       <button class="btn-primary" onclick="openUnitModal()">+ ุดูุฉ ุฌุฏูุฏุฉ</button>
      </div>
     </div>
     <div class="card">
      <div class="table-container">
       <table id="units-table">
        <thead>
         <tr>
          <th>ุงููููุน</th>
          <th>ุฑูู ุงูุดูุฉ</th>
          <th>ุงูููุน</th>
          <th>ุงุณู ุงููุณุชุฃุฌุฑ</th>
          <th>ุฑูู ุงูุฌูุงู</th>
          <th>ุนุฏุฏ ุงูุฃุดุฎุงุต</th>
          <th>ุตูุฑุฉ ุงูุฌูุงุฒ/ุงููููุฉ</th>
          <th>ุงูุญุงูุฉ</th>
          <th>ุขุฎุฑ ุชูุธูู</th>
          <th>ุฌุงูุฒุฉ ููุญุฌุฒ</th>
          <th>ุฅุฌุฑุงุกุงุช</th>
         </tr>
        </thead>
        <tbody id="units-body"></tbody>
       </table>
      </div>
     </div>
    </div><!-- Cleaning Tab -->
    <div id="cleaning-tab" class="tab-content" style="display: none;">
     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
      <h2 style="font-size: 1.5rem; font-weight: bold;">ููุงู ุงูุชูุธูู</h2><button class="btn-primary" onclick="openCleaningModal()">+ ูููุฉ ุชูุธูู</button>
     </div>
     <div class="card">
      <div class="table-container">
       <table id="cleaning-table">
        <thead>
         <tr>
          <th>ุงููููุน</th>
          <th>ุฑูู ุงูุดูุฉ</th>
          <th>ุงูุณุจุจ</th>
          <th>ุงูุชุงุฑูุฎ</th>
          <th>ุงูุจุฏุก</th>
          <th>ุงูุงูุชูุงุก</th>
          <th>ุงููุณุคูู</th>
          <th>ุงูุญุงูุฉ</th>
          <th>ุฅุฌุฑุงุกุงุช</th>
         </tr>
        </thead>
        <tbody id="cleaning-body"></tbody>
       </table>
      </div>
     </div>
    </div><!-- Inspection Tab -->
    <div id="inspection-tab" class="tab-content" style="display: none;">
     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
      <h2 style="font-size: 1.5rem; font-weight: bold;">ุณุฌู ุงูุชูุชูุด</h2><button class="btn-primary" onclick="openInspectionModal()">+ ุชูุชูุด ุฌุฏูุฏ</button>
     </div>
     <div class="card">
      <div class="table-container">
       <table id="inspection-table">
        <thead>
         <tr>
          <th>ุงููููุน</th>
          <th>ุฑูู ุงูุดูุฉ</th>
          <th>ุงูุชุงุฑูุฎ</th>
          <th>Wi-Fi</th>
          <th>ุงููุธุงูุฉ</th>
          <th>ุงููุณุชูุฒูุงุช</th>
          <th>ููุงุญุธุงุช</th>
          <th>ูุนุชูุฏุฉ</th>
          <th>ุฅุฌุฑุงุกุงุช</th>
         </tr>
        </thead>
        <tbody id="inspection-body"></tbody>
       </table>
      </div>
     </div>
    </div><!-- Delivery Tab -->
    <div id="delivery-tab" class="tab-content" style="display: none;">
     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
      <h2 style="font-size: 1.5rem; font-weight: bold;">ุฅุฏุงุฑุฉ ุงูุชูุตูู</h2><button class="btn-primary" onclick="openDeliveryModal()">+ ุทูุจ ุชูุตูู ุฌุฏูุฏ</button>
     </div>
     <div class="card">
      <div class="table-container">
       <table id="delivery-table">
        <thead>
         <tr>
          <th>ุงูุงุณู</th>
          <th>ุฑูู ุงูุฌูุงู</th>
          <th>ุงููููุน</th>
          <th>ุฑูู ุงูุดูุฉ</th>
          <th>ุงูุนููุงู</th>
          <th>ุชุงุฑูุฎ ุงูุญุฌุฒ</th>
          <th>ููุช ุงูุฏุฎูู</th>
          <th>ููุช ุงูุฎุฑูุฌ</th>
          <th>ุญุงูุฉ ุงูุชูุตูู</th>
          <th>ููุงุญุธุงุช</th>
          <th>ุฅุฌุฑุงุกุงุช</th>
         </tr>
        </thead>
        <tbody id="delivery-body"></tbody>
       </table>
      </div>
     </div>
    </div><!-- Inventory Tab -->
    <div id="inventory-tab" class="tab-content" style="display: none;">
     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
      <h2 style="font-size: 1.5rem; font-weight: bold;">ุฅุฏุงุฑุฉ ุงููุณุชูุฒูุงุช</h2>
      <div style="display: flex; gap: 1rem;"><button class="btn-success" onclick="openSetupModal()">โก ุฅุนุฏุงุฏ ุดูุฉ ุฌุฏูุฏุฉ</button> <button class="btn-primary" onclick="openInventoryModal()">+ ุตูู ูุฎุตุต</button>
      </div>
     </div><!-- Filters -->
     <div class="card" style="margin-bottom: 1.5rem;">
      <h3 style="font-size: 1.125rem; font-weight: bold; margin-bottom: 1rem;">๐ ุชุตููุฉ ุงููุณุชูุฒูุงุช</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
       <div class="form-group" style="margin-bottom: 0;"><label for="filter-location">ุงููููุน</label> <select id="filter-location" onchange="renderInventory()"> <option value="">ุฌููุน ุงูููุงูุน</option> <option value="aster">aster</option> <option value="vantage">vantage</option> <option value="sky">sky</option> <option value="lumos">lumos</option> <option value="lumont">lumont</option> </select>
       </div>
       <div class="form-group" style="margin-bottom: 0;"><label for="filter-unit">ุฑูู ุงูุดูุฉ</label> <select id="filter-unit" onchange="renderInventory()"> <option value="">ุฌููุน ุงูุดูู</option> </select>
       </div>
       <div class="form-group" style="margin-bottom: 0;"><label for="filter-category">ุงููุฆุฉ</label> <select id="filter-category" onchange="renderInventory()"> <option value="">ุฌููุน ุงููุฆุงุช</option> <option value="Bedroom">๐๏ธ Bedroom</option> <option value="Bathroom">๐ฟ Bathroom</option> <option value="Kitchen">๐ฝ๏ธ Kitchen</option> <option value="Cleaning Supplies">๐งผ Cleaning Supplies</option> <option value="Guest Essentials">โจ Guest Essentials</option> </select>
       </div>
       <div class="form-group" style="margin-bottom: 0;"><label>ูุญุชุงุฌ ุชุนุจุฆุฉ ููุท</label>
        <div class="checkbox-group"><input type="checkbox" id="filter-needs-refill" onchange="renderInventory()"> <label for="filter-needs-refill" style="margin: 0;">ุนุฑุถ ุงูููุงูุต ููุท</label>
        </div>
       </div>
      </div>
     </div>
     <div class="card">
      <div class="table-container">
       <table id="inventory-table">
        <thead>
         <tr>
          <th>ุงููููุน</th>
          <th>ุฑูู ุงูุดูุฉ</th>
          <th>ุงููุฆุฉ</th>
          <th>ุงูุตูู</th>
          <th>ุงููููุฉ ุงูุญุงููุฉ</th>
          <th>ุงูุญุฏ ุงูุฃุฏูู</th>
          <th>ูุญุชุงุฌ ุชุนุจุฆุฉ</th>
          <th>ุฅุฌุฑุงุกุงุช</th>
         </tr>
        </thead>
        <tbody id="inventory-body"></tbody>
       </table>
      </div>
     </div>
    </div><!-- Maintenance Tab -->
    <div id="maintenance-tab" class="tab-content" style="display: none;">
     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
      <h2 style="font-size: 1.5rem; font-weight: bold;">ุฅุฏุงุฑุฉ ุทูุจุงุช ุงูุตูุงูุฉ</h2><button class="btn-primary" onclick="openMaintenanceModal()">+ ุทูุจ ุตูุงูุฉ ุฌุฏูุฏ</button>
     </div>
     <div class="card">
      <div class="table-container">
       <table id="maintenance-table">
        <thead>
         <tr>
          <th>ุงููููุน</th>
          <th>ุฑูู ุงูุดูุฉ</th>
          <th>ููุน ุงูุตูุงูุฉ</th>
          <th>ุงููุตู</th>
          <th>ุงูุชุงุฑูุฎ</th>
          <th>ุงูุญุงูุฉ</th>
          <th>ุงููุณุคูู</th>
          <th>ุงูุชูููุฉ</th>
          <th>ููุงุญุธุงุช</th>
          <th>ุฅุฌุฑุงุกุงุช</th>
         </tr>
        </thead>
        <tbody id="maintenance-body">        </tbody>
       </table>
      </div>
     </div>
    </div><!-- POS Tab -->
    <div id="pos-tab" class="tab-content" style="display: none;">
     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
      <h2 style="font-size: 1.5rem; font-weight: bold;">๐ณ ูุธุงู ุงูุฏูุนุงุช ูุงูุฅูุฌุงุฑุงุช</h2><button class="btn-primary" onclick="openPOSModal()">+ ุฏูุนุฉ ุฌุฏูุฏุฉ</button>
     </div>
     <div class="card">
      <div class="table-container">
       <table id="pos-table">
        <thead>
         <tr>
          <th>ุชุงุฑูุฎ ุงูุฏุฎูู</th>
          <th>ุนููุงู ุงูุดูุฉ</th>
          <th>ุฑูู ุงูุฌูุงู</th>
          <th>ุฑุฃุณ ุงููุงู</th>
          <th>ุณุนุฑ ุงููุณุชุฃุฌุฑ</th>
          <th>ุงูููุงุชูุฑ ุงููุฎุตููุฉ</th>
          <th>ูููุฉ ุงูุฑุจุญ</th>
          <th>ุญุงูุฉ ุงูุฏูุน</th>
          <th>ุชุงุฑูุฎ ุงูุฏูุน</th>
          <th>ููุงุญุธุงุช</th>
          <th>ุฅุฌุฑุงุกุงุช</th>
         </tr>
        </thead>
        <tbody id="pos-body"></tbody>
       </table>
      </div>
     </div>
    </div><!-- Invoices Tab -->
    <div id="invoices-tab" class="tab-content" style="display: none;">
     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
      <h2 style="font-size: 1.5rem; font-weight: bold;">ุฅุฏุงุฑุฉ ุงูููุงุชูุฑ</h2><button class="btn-primary" onclick="openInvoiceModal()">+ ูุงุชูุฑุฉ ุฌุฏูุฏุฉ</button>
     </div>
     <div class="card">
      <div class="table-container">
       <table id="invoices-table">
        <thead>
         <tr>
          <th>ุฑูู ุงููุงุชูุฑุฉ</th>
          <th>ุงููููุน</th>
          <th>ุฑูู ุงูุดูุฉ</th>
          <th>ุงูููุน</th>
          <th>ุงููุจูุบ</th>
          <th>ุงูุชุงุฑูุฎ</th>
          <th>ุงูุญุงูุฉ</th>
          <th>ุงูุตูุฑุฉ</th>
          <th>ููุงุญุธุงุช</th>
          <th>ุฅุฌุฑุงุกุงุช</th>
         </tr>
        </thead>
        <tbody id="invoices-body"></tbody>
       </table>
      </div>
     </div>
    </div>
   </main><!-- Modals --> <!-- Booking Modal -->
   <div id="booking-modal" class="modal">
    <div class="modal-content">
     <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1.5rem;">ุญุฌุฒ ุฌุฏูุฏ</h2>
     <form id="booking-form" onsubmit="saveBooking(event)">
      <div class="form-group"><label for="booking-location">ุงููููุน</label> <select id="booking-location" required> <option value="">ุงุฎุชุฑ ุงููููุน</option> <option value="aster">aster</option> <option value="vantage">vantage</option> <option value="sky">sky</option> <option value="lumos">lumos</option> <option value="lumont">lumont</option> </select>
      </div>
      <div class="form-group"><label for="booking-unit">ุฑูู ุงูุดูุฉ</label> <input type="text" id="booking-unit" required>
      </div>
      <div class="form-group"><label for="booking-guest">ุงุณู ุงููุณุชุฃุฌุฑ</label> <input type="text" id="booking-guest" required>
      </div>
      <div class="form-group"><label for="booking-phone">ุฑูู ุงููุงุชู</label> <input type="tel" id="booking-phone" required>
      </div>
      <div class="form-group"><label for="booking-address">ุงูุนููุงู (ุงุฎุชูุงุฑู)</label> <textarea id="booking-address" rows="2" placeholder="ุนููุงู ุงูุชูุตูู ุฅุฐุง ูุงู ูุทููุจ"></textarea>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
       <div class="form-group"><label for="booking-checkin-date">ุชุงุฑูุฎ ุงูุฏุฎูู</label> <input type="date" id="booking-checkin-date" required>
       </div>
       <div class="form-group"><label for="booking-checkin-time">ููุช ุงูุฏุฎูู</label> <input type="time" id="booking-checkin-time" value="15:00" required>
       </div>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
       <div class="form-group"><label for="booking-checkout-date">ุชุงุฑูุฎ ุงูุฎุฑูุฌ</label> <input type="date" id="booking-checkout-date" required>
       </div>
       <div class="form-group"><label for="booking-checkout-time">ููุช ุงูุฎุฑูุฌ</label> <input type="time" id="booking-checkout-time" value="11:00" required>
       </div>
      </div>
      <div class="form-group"><label for="booking-guests">ุนุฏุฏ ุงูุถููู</label> <input type="number" id="booking-guests" min="1" value="1" required>
      </div>
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem;"><button type="submit" class="btn-primary" style="flex: 1;">ุญูุธ</button> <button type="button" class="btn-secondary" style="flex: 1;" onclick="closeModal('booking-modal')">ุฅูุบุงุก</button>
      </div>
     </form>
    </div>
   </div><!-- Unit Modal -->
   <div id="unit-modal" class="modal">
    <div class="modal-content">
     <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1.5rem;">ุดูุฉ ุฌุฏูุฏุฉ</h2>
     <form id="unit-form" onsubmit="saveUnit(event)">
      <div class="form-group"><label for="unit-location">ุงููููุน</label> <select id="unit-location" required> <option value="">ุงุฎุชุฑ ุงููููุน</option> <option value="aster">aster</option> <option value="vantage">vantage</option> <option value="sky">sky</option> <option value="lumos">lumos</option> <option value="lumont">lumont</option> </select>
      </div>
      <div class="form-group"><label for="unit-number">ุฑูู ุงูุดูุฉ</label> <input type="text" id="unit-number" required>
      </div>
      <div class="form-group"><label for="unit-type">ููุน ุงูุดูุฉ</label> <select id="unit-type" required> <option value="">ุงุฎุชุฑ ุงูููุน</option> <option value="Studio">Studio</option> <option value="1BR">1BR</option> <option value="2BR">2BR</option> <option value="3BR">3BR</option> </select>
      </div>
      <div class="form-group"><label for="unit-tenant">ุงุณู ุงููุณุชุฃุฌุฑ</label> <input type="text" id="unit-tenant" placeholder="ุงุณู ุงููุณุชุฃุฌุฑ (ุงุฎุชูุงุฑู)">
      </div>
      <div class="form-group"><label for="unit-phone">ุฑูู ุงูุฌูุงู</label> <input type="tel" id="unit-phone" placeholder="ุฑูู ุงูุฌูุงู (ุงุฎุชูุงุฑู)">
      </div>
      <div class="form-group"><label for="unit-occupants">ุนุฏุฏ ุงูุฃุดุฎุงุต</label> <input type="number" id="unit-occupants" min="0" value="0" placeholder="ุนุฏุฏ ุงูุฃุดุฎุงุต">
      </div>
      <div class="form-group"><label for="unit-id-image">ุตูุฑุฉ ุงูุฌูุงุฒ/ุงููููุฉ</label> <input type="file" id="unit-id-image" accept="image/*" onchange="handleUnitIdImage(event)"> <div id="unit-id-image-preview" style="margin-top: 0.5rem; display: none;"><img id="unit-id-preview-img" style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid #e5e7eb;" alt="Preview"> <button type="button" onclick="clearUnitIdImage()" style="margin-top: 0.5rem; padding: 0.5rem; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer;">ุฅุฒุงูุฉ ุงูุตูุฑุฉ</button>
      </div>
      </div>
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem;"><button type="submit" class="btn-primary" style="flex: 1;">ุญูุธ</button> <button type="button" class="btn-secondary" style="flex: 1;" onclick="closeModal('unit-modal')">ุฅูุบุงุก</button>
      </div>
     </form>
    </div>
   </div><!-- Cleaning Modal -->
   <div id="cleaning-modal" class="modal">
    <div class="modal-content">
     <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1.5rem;">ูููุฉ ุชูุธูู ุฌุฏูุฏุฉ</h2>
     <form id="cleaning-form" onsubmit="saveCleaning(event)">
      <div class="form-group"><label for="cleaning-location">ุงููููุน</label> <select id="cleaning-location" required> <option value="">ุงุฎุชุฑ ุงููููุน</option> <option value="aster">aster</option> <option value="vantage">vantage</option> <option value="sky">sky</option> <option value="lumos">lumos</option> <option value="lumont">lumont</option> </select>
      </div>
      <div class="form-group"><label for="cleaning-unit">ุฑูู ุงูุดูุฉ</label> <input type="text" id="cleaning-unit" required>
      </div>
      <div class="form-group"><label for="cleaning-reason">ุณุจุจ ุงูุชูุธูู</label> <select id="cleaning-reason" required> <option value="">ุงุฎุชุฑ ุงูุณุจุจ</option> <option value="Check-out Cleaning">Check-out Cleaning</option> <option value="Stayover Cleaning">Stayover Cleaning</option> <option value="Deep Cleaning">Deep Cleaning</option> <option value="After Maintenance">After Maintenance</option> </select>
      </div>
      <div class="form-group"><label for="cleaning-date">ุงูุชุงุฑูุฎ</label> <input type="date" id="cleaning-date" required>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
       <div class="form-group"><label for="cleaning-start">ููุช ุงูุจุฏุก</label> <input type="time" id="cleaning-start" required>
       </div>
       <div class="form-group"><label for="cleaning-end">ููุช ุงูุงูุชูุงุก</label> <input type="time" id="cleaning-end">
       </div>
      </div>
      <div class="form-group"><label for="cleaning-cleaner">ุงููุณุคูู</label> <input type="text" id="cleaning-cleaner">
      </div>
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem;"><button type="submit" class="btn-primary" style="flex: 1;">ุญูุธ</button> <button type="button" class="btn-secondary" style="flex: 1;" onclick="closeModal('cleaning-modal')">ุฅูุบุงุก</button>
      </div>
     </form>
    </div>
   </div><!-- Inspection Modal -->
   <div id="inspection-modal" class="modal">
    <div class="modal-content">
     <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1.5rem;">ุชูุชูุด ุฌุฏูุฏ</h2>
     <form id="inspection-form" onsubmit="saveInspection(event)">
      <div class="form-group"><label for="inspection-location">ุงููููุน</label> <select id="inspection-location" required> <option value="">ุงุฎุชุฑ ุงููููุน</option> <option value="aster">aster</option> <option value="vantage">vantage</option> <option value="sky">sky</option> <option value="lumos">lumos</option> <option value="lumont">lumont</option> </select>
      </div>
      <div class="form-group"><label for="inspection-unit">ุฑูู ุงูุดูุฉ</label> <input type="text" id="inspection-unit" required>
      </div>
      <div class="form-group"><label for="inspection-date">ุงูุชุงุฑูุฎ</label> <input type="date" id="inspection-date" required>
      </div>
      <div class="checkbox-group form-group"><input type="checkbox" id="inspection-wifi"> <label for="inspection-wifi" style="margin: 0;">Wi-Fi ูุนูู</label>
      </div>
      <div class="checkbox-group form-group"><input type="checkbox" id="inspection-clean"> <label for="inspection-clean" style="margin: 0;">ุงููุธุงูุฉ ููุชุงุฒุฉ</label>
      </div>
      <div class="checkbox-group form-group"><input type="checkbox" id="inspection-supplies"> <label for="inspection-supplies" style="margin: 0;">ุงููุณุชูุฒูุงุช ูุงููุฉ</label>
      </div>
      <div class="form-group"><label for="inspection-notes">ููุงุญุธุงุช</label> <textarea id="inspection-notes" rows="3"></textarea>
      </div>
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem;"><button type="submit" class="btn-primary" style="flex: 1;">ุญูุธ</button> <button type="button" class="btn-secondary" style="flex: 1;" onclick="closeModal('inspection-modal')">ุฅูุบุงุก</button>
      </div>
     </form>
    </div>
   </div><!-- Inventory Modal -->
   <div id="inventory-modal" class="modal">
    <div class="modal-content">
     <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1.5rem;">ุตูู ูุฎุตุต</h2>
     <form id="inventory-form" onsubmit="saveInventory(event)">
      <div class="form-group"><label for="inventory-location">ุงููููุน</label> <select id="inventory-location" required> <option value="">ุงุฎุชุฑ ุงููููุน</option> <option value="aster">aster</option> <option value="vantage">vantage</option> <option value="sky">sky</option> <option value="lumos">lumos</option> <option value="lumont">lumont</option> </select>
      </div>
      <div class="form-group"><label for="inventory-unit">ุฑูู ุงูุดูุฉ</label> <input type="text" id="inventory-unit" required>
      </div>
      <div class="form-group"><label for="inventory-category">ุงููุฆุฉ</label> <select id="inventory-category" required> <option value="">ุงุฎุชุฑ ุงููุฆุฉ</option> <option value="Bedroom">๐๏ธ Bedroom</option> <option value="Bathroom">๐ฟ Bathroom</option> <option value="Kitchen">๐ฝ๏ธ Kitchen</option> <option value="Cleaning Supplies">๐งผ Cleaning Supplies</option> <option value="Guest Essentials">โจ Guest Essentials</option> </select>
      </div>
      <div class="form-group"><label for="inventory-item">ุงุณู ุงูุตูู</label> <input type="text" id="inventory-item" required>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
       <div class="form-group"><label for="inventory-current">ุงููููุฉ ุงูุญุงููุฉ</label> <input type="number" id="inventory-current" min="0" value="0" required>
       </div>
       <div class="form-group"><label for="inventory-minimum">ุงูุญุฏ ุงูุฃุฏูู</label> <input type="number" id="inventory-minimum" min="0" value="1" required>
       </div>
      </div>
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem;"><button type="submit" class="btn-primary" style="flex: 1;">ุญูุธ</button> <button type="button" class="btn-secondary" style="flex: 1;" onclick="closeModal('inventory-modal')">ุฅูุบุงุก</button>
      </div>
     </form>
    </div>
   </div><!-- Setup Unit Modal -->
   <div id="setup-modal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
     <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1.5rem;">โก ุฅุนุฏุงุฏ ุดูุฉ ุฌุฏูุฏุฉ - ุงููุณุชูุฒูุงุช ุงูููุงุณูุฉ</h2>
     <form id="setup-form" onsubmit="setupUnitInventory(event)">
      <div class="form-group"><label for="setup-location">ุงููููุน</label> <select id="setup-location" required> <option value="">ุงุฎุชุฑ ุงููููุน</option> <option value="aster">aster</option> <option value="vantage">vantage</option> <option value="sky">sky</option> <option value="lumos">lumos</option> <option value="lumont">lumont</option> </select>
      </div>
      <div class="form-group"><label for="setup-unit">ุฑูู ุงูุดูุฉ</label> <input type="text" id="setup-unit" required>
      </div>
      <div style="margin-top: 1.5rem; padding: 1rem; background: #f9fafb; border-radius: 8px;">
       <p style="font-weight: 600; margin-bottom: 1rem;">ุณูุชู ุฅุถุงูุฉ ุงููุณุชูุฒูุงุช ุงูุชุงููุฉ ุชููุงุฆูุงู:</p>
       <div style="margin-bottom: 1rem;">
        <h3 style="font-weight: bold; margin-bottom: 0.5rem;">๐๏ธ Bedroom (4 ุฃุตูุงู)</h3>
        <ul style="margin: 0; padding-right: 1.5rem;">
         <li>Bed Sheets Sets (2)</li>
         <li>Pillows (4)</li>
         <li>Extra Blanket (1)</li>
         <li>Hangers (15)</li>
        </ul>
       </div>
       <div style="margin-bottom: 1rem;">
        <h3 style="font-weight: bold; margin-bottom: 0.5rem;">๐ฟ Bathroom (8 ุฃุตูุงู)</h3>
        <ul style="margin: 0; padding-right: 1.5rem;">
         <li>Bath Towels (4)</li>
         <li>Hand Towels (4)</li>
         <li>Bath Mat (2)</li>
         <li>Shampoo Bottles (2)</li>
         <li>Conditioner Bottles (2)</li>
         <li>Hand Soap (2)</li>
         <li>Hair Dryer (1)</li>
         <li>Trash Bags Roll (1)</li>
        </ul>
       </div>
       <div style="margin-bottom: 1rem;">
        <h3 style="font-weight: bold; margin-bottom: 0.5rem;">๐ฝ๏ธ Kitchen (10 ุฃุตูุงู)</h3>
        <ul style="margin: 0; padding-right: 1.5rem;">
         <li>Dinner Plates (8)</li>
         <li>Cups/Mugs (8)</li>
         <li>Cutlery Set (8)</li>
         <li>Cooking Pots (2)</li>
         <li>Frying Pan (1)</li>
         <li>Electric Kettle (1)</li>
         <li>Coffee Machine (1)</li>
         <li>Coffee Packs (3)</li>
         <li>Tea Bags Box (1)</li>
         <li>Sugar Pack (1)</li>
        </ul>
       </div>
       <div style="margin-bottom: 1rem;">
        <h3 style="font-weight: bold; margin-bottom: 0.5rem;">๐งผ Cleaning Supplies (6 ุฃุตูุงู)</h3>
        <ul style="margin: 0; padding-right: 1.5rem;">
         <li>Floor Cleaner Bottle (1)</li>
         <li>Disinfectant Spray (1)</li>
         <li>Mop (1)</li>
         <li>Broom (1)</li>
         <li>Sponges Pack (1)</li>
         <li>Cleaning Gloves (2 pairs)</li>
        </ul>
       </div>
       <div style="margin-bottom: 0;">
        <h3 style="font-weight: bold; margin-bottom: 0.5rem;">โจ Guest Essentials (3 ุฃุตูุงู)</h3>
        <ul style="margin: 0; padding-right: 1.5rem;">
         <li>Toilet Paper Rolls (6)</li>
         <li>Paper Towels Roll (2)</li>
         <li>Tissues Box (2)</li>
        </ul>
       </div>
       <div style="margin-top: 1rem; padding: 0.75rem; background: #dbeafe; border-radius: 6px; color: #1e40af;"><strong>ุงูุฅุฌูุงูู: 33 ุตูู</strong>
       </div>
      </div>
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem;"><button type="submit" class="btn-success" style="flex: 1;">โก ุฅุนุฏุงุฏ ุงูุดูุฉ</button> <button type="button" class="btn-secondary" style="flex: 1;" onclick="closeModal('setup-modal')">ุฅูุบุงุก</button>
      </div>
     </form>
    </div>
   </div><!-- Delivery Modal -->
   <div id="delivery-modal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
     <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1.5rem;">ุทูุจ ุชูุตูู ุฌุฏูุฏ</h2>
     <form id="delivery-form" onsubmit="saveDelivery(event)">
      <div class="form-group"><label for="delivery-booking">ุฑุจุท ุจุญุฌุฒ ููุฌูุฏ (ุงุฎุชูุงุฑู)</label> <select id="delivery-booking" onchange="fillDeliveryFromBooking()"> <option value="">ุงุฎุชุฑ ุญุฌุฒ (ุฃู ุงุชุฑูู ูุงุฑุบุงู ูุฅุถุงูุฉ ุฌุฏูุฏ)</option> </select>
      </div>
      <div class="form-group"><label for="delivery-name">ุงุณู ุงูุนููู</label> <input type="text" id="delivery-name" required>
      </div>
      <div class="form-group"><label for="delivery-phone">ุฑูู ุงูุฌูุงู</label> <input type="tel" id="delivery-phone" required>
      </div>
      <div class="form-group"><label for="delivery-location">ุงููููุน</label> <select id="delivery-location" required> <option value="">ุงุฎุชุฑ ุงููููุน</option> <option value="aster">aster</option> <option value="vantage">vantage</option> <option value="sky">sky</option> <option value="lumos">lumos</option> <option value="lumont">lumont</option> </select>
      </div>
      <div class="form-group"><label for="delivery-unit">ุฑูู ุงูุดูุฉ</label> <input type="text" id="delivery-unit" required>
      </div>
      <div class="form-group"><label for="delivery-address">ุนููุงู ุงูุชูุตูู</label> <textarea id="delivery-address" rows="3" required placeholder="ุงูุนููุงู ุงููุงูู ููุชูุตูู"></textarea>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
       <div class="form-group"><label for="delivery-checkin-date">ุชุงุฑูุฎ ุงูุญุฌุฒ (ุฏุฎูู)</label> <input type="date" id="delivery-checkin-date" required>
       </div>
       <div class="form-group"><label for="delivery-checkin-time">ููุช ุงูุฏุฎูู</label> <input type="time" id="delivery-checkin-time" value="15:00" required>
       </div>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
       <div class="form-group"><label for="delivery-checkout-date">ุชุงุฑูุฎ ุงูุฎุฑูุฌ</label> <input type="date" id="delivery-checkout-date" required>
       </div>
       <div class="form-group"><label for="delivery-checkout-time">ููุช ุงูุฎุฑูุฌ</label> <input type="time" id="delivery-checkout-time" value="11:00" required>
       </div>
      </div>
      <div class="form-group"><label for="delivery-status">ุญุงูุฉ ุงูุชูุตูู</label> <select id="delivery-status" required> <option value="Pending">โณ ููุฏ ุงูุงูุชุธุงุฑ</option> <option value="Scheduled">๐ ูุฌุฏูู</option> <option value="In Transit">๐ ููุฏ ุงูุชูุตูู</option> <option value="Delivered">โ ุชู ุงูุชูุตูู</option> <option value="Cancelled">โ ููุบู</option> </select>
      </div>
      <div class="form-group"><label for="delivery-notes">ููุงุญุธุงุช ุงูุชูุตูู</label> <textarea id="delivery-notes" rows="3" placeholder="ููุงุญุธุงุช ุฅุถุงููุฉ ุนู ุงูุชูุตูู"></textarea>
      </div>
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem;"><button type="submit" class="btn-primary" style="flex: 1;">ุญูุธ</button> <button type="button" class="btn-secondary" style="flex: 1;" onclick="closeModal('delivery-modal')">ุฅูุบุงุก</button>
      </div>
     </form>
    </div>
   </div><!-- Update Quantity Modal -->
   <div id="update-quantity-modal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
     <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1.5rem;">ุชุญุฏูุซ ุงููููุฉ</h2>
     <div id="update-item-info" style="margin-bottom: 1rem; padding: 1rem; background: #f9fafb; border-radius: 8px;"></div>
     <form id="update-quantity-form" onsubmit="saveQuantityUpdate(event)">
      <div class="form-group"><label for="new-quantity">ุงููููุฉ ุงูุฌุฏูุฏุฉ</label> <input type="number" id="new-quantity" min="0" required>
      </div>
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem;"><button type="submit" class="btn-primary" style="flex: 1;">ุญูุธ</button> <button type="button" class="btn-secondary" style="flex: 1;" onclick="closeModal('update-quantity-modal')">ุฅูุบุงุก</button>
      </div>
     </form>
    </div>
   </div><!-- Maintenance Modal -->
   <div id="maintenance-modal" class="modal">
    <div class="modal-content">
     <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1.5rem;">ุทูุจ ุตูุงูุฉ ุฌุฏูุฏ</h2>
     <form id="maintenance-form" onsubmit="saveMaintenance(event)">
      <div class="form-group"><label for="maintenance-location">ุงููููุน</label> <select id="maintenance-location" required> <option value="">ุงุฎุชุฑ ุงููููุน</option> <option value="aster">aster</option> <option value="vantage">vantage</option> <option value="sky">sky</option> <option value="lumos">lumos</option> <option value="lumont">lumont</option> </select>
      </div>
      <div class="form-group"><label for="maintenance-unit">ุฑูู ุงูุดูุฉ</label> <input type="text" id="maintenance-unit" required>
      </div>
      <div class="form-group"><label for="maintenance-type">ููุน ุงูุตูุงูุฉ</label> <select id="maintenance-type" required> <option value="">ุงุฎุชุฑ ุงูููุน</option> <option value="ููุฑุจุงุก">ููุฑุจุงุก</option> <option value="ุณุจุงูุฉ">ุณุจุงูุฉ</option> <option value="ุชูููู">ุชูููู</option> <option value="ูุธุงูุฉ">ูุธุงูุฉ</option> <option value="ุฏูุงู">ุฏูุงู</option> <option value="ุฃุฎุฑู">ุฃุฎุฑู</option> </select>
      </div>
      <div class="form-group"><label for="maintenance-description">ุงููุตู</label> <textarea id="maintenance-description" rows="3" required placeholder="ูุตู ุงููุดููุฉ ุฃู ุทูุจ ุงูุตูุงูุฉ"></textarea>
      </div>
      <div class="form-group"><label for="maintenance-date">ุงูุชุงุฑูุฎ</label> <input type="date" id="maintenance-date" required>
      </div>
      <div class="form-group"><label for="maintenance-status">ุงูุญุงูุฉ</label> <select id="maintenance-status" required> <option value="Pending">โณ ููุฏ ุงูุงูุชุธุงุฑ</option> <option value="In Progress">๐ ููุฏ ุงูุชูููุฐ</option> <option value="Completed">โ ููุชููุฉ</option> <option value="Cancelled">โ ููุบูุฉ</option> </select>
      </div>
      <div class="form-group"><label for="maintenance-assigned">ุงููุณุคูู</label> <input type="text" id="maintenance-assigned" placeholder="ุงุณู ุงููุณุคูู ุนู ุงูุตูุงูุฉ">
      </div>
      <div class="form-group"><label for="maintenance-cost">ุงูุชูููุฉ</label> <input type="number" id="maintenance-cost" min="0" step="0.01" placeholder="0.00">
      </div>
      <div class="form-group"><label for="maintenance-notes">ููุงุญุธุงุช</label> <textarea id="maintenance-notes" rows="2" placeholder="ููุงุญุธุงุช ุฅุถุงููุฉ"></textarea>
      </div>
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem;"><button type="submit" class="btn-primary" style="flex: 1;">ุญูุธ</button> <button type="button" class="btn-secondary" style="flex: 1;" onclick="closeModal('maintenance-modal')">ุฅูุบุงุก</button>
      </div>
     </form>
    </div>
   </div><!-- Invoice Modal -->
   <div id="invoice-modal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
     <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1.5rem;">ูุงุชูุฑุฉ ุฌุฏูุฏุฉ</h2>
     <form id="invoice-form" onsubmit="saveInvoice(event)">
      <div class="form-group"><label for="invoice-number">ุฑูู ุงููุงุชูุฑุฉ</label> <input type="text" id="invoice-number" required placeholder="ุฑูู ุงููุงุชูุฑุฉ">
      </div>
      <div class="form-group"><label for="invoice-location">ุงููููุน</label> <select id="invoice-location" required> <option value="">ุงุฎุชุฑ ุงููููุน</option> <option value="aster">aster</option> <option value="vantage">vantage</option> <option value="sky">sky</option> <option value="lumos">lumos</option> <option value="lumont">lumont</option> </select>
      </div>
      <div class="form-group"><label for="invoice-unit">ุฑูู ุงูุดูุฉ</label> <input type="text" id="invoice-unit" required>
      </div>
      <div class="form-group"><label for="invoice-type">ููุน ุงููุงุชูุฑุฉ</label> <select id="invoice-type" required> <option value="">ุงุฎุชุฑ ุงูููุน</option> <option value="ุตูุงูุฉ">ุตูุงูุฉ</option> <option value="ุฎุฏูุงุช">ุฎุฏูุงุช</option> <option value="ููุฑุจุงุก">ููุฑุจุงุก</option> <option value="ูุงุก">ูุงุก</option> <option value="ุฅูุชุฑูุช">ุฅูุชุฑูุช</option> <option value="ุฃุฎุฑู">ุฃุฎุฑู</option> </select>
      </div>
      <div class="form-group"><label for="invoice-amount">ุงููุจูุบ</label> <input type="number" id="invoice-amount" min="0" step="0.01" required placeholder="0.00">
      </div>
      <div class="form-group"><label for="invoice-date">ุงูุชุงุฑูุฎ</label> <input type="date" id="invoice-date" required>
      </div>
      <div class="form-group"><label for="invoice-status">ุงูุญุงูุฉ</label> <select id="invoice-status" required> <option value="Pending">โณ ููุฏ ุงูุงูุชุธุงุฑ</option> <option value="Paid">โ ูุฏููุนุฉ</option> <option value="Overdue">โ๏ธ ูุชุฃุฎุฑุฉ</option> <option value="Cancelled">โ ููุบูุฉ</option> </select>
      </div>
      <div class="form-group"><label for="invoice-image">ุตูุฑุฉ ุงููุงุชูุฑุฉ</label> <input type="file" id="invoice-image" accept="image/*" onchange="handleInvoiceImage(event)"> <div id="invoice-image-preview" style="margin-top: 0.5rem; display: none;"><img id="invoice-preview-img" style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid #e5e7eb;" alt="Preview"> <button type="button" onclick="clearInvoiceImage()" style="margin-top: 0.5rem; padding: 0.5rem; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer;">ุฅุฒุงูุฉ ุงูุตูุฑุฉ</button>
      </div>
      </div>
      <div class="form-group"><label for="invoice-notes">ููุงุญุธุงุช</label> <textarea id="invoice-notes" rows="2" placeholder="ููุงุญุธุงุช ุฅุถุงููุฉ"></textarea>
      </div>
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem;"><button type="submit" class="btn-primary" style="flex: 1;">ุญูุธ</button> <button type="button" class="btn-secondary" style="flex: 1;" onclick="closeModal('invoice-modal')">ุฅูุบุงุก</button>
      </div>
     </form>
    </div>
   </div><!-- POS Modal -->
   <div id="pos-modal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
     <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1.5rem;">๐ณ ุฏูุนุฉ ุฌุฏูุฏุฉ</h2>
     <form id="pos-form" onsubmit="savePOS(event)">
      <div class="form-group"><label for="pos-checkin-date">ุชุงุฑูุฎ ุงูุฏุฎูู</label> <input type="date" id="pos-checkin-date" required>
      </div>
      <div class="form-group"><label for="pos-location">ุงููููุน</label> <select id="pos-location" required onchange="updatePOSUnits()"> <option value="">ุงุฎุชุฑ ุงููููุน</option> <option value="aster">aster</option> <option value="vantage">vantage</option> <option value="sky">sky</option> <option value="lumos">lumos</option> <option value="lumont">lumont</option> </select>
      </div>
      <div class="form-group"><label for="pos-unit">ุงุฎุชุฑ ุงูุดูุฉ</label> <select id="pos-unit" required onchange="fillPOSFromUnit()"> <option value="">ุงุฎุชุฑ ุงูุดูุฉ ุฃููุงู</option> </select>
      </div>
      <div class="form-group"><label for="pos-address">ุนููุงู ุงูุดูุฉ</label> <textarea id="pos-address" rows="2" required placeholder="ุนููุงู ุงูุดูุฉ ุงููุงูู"></textarea>
      </div>
      <div class="form-group"><label for="pos-phone">ุฑูู ุงูุฌูุงู</label> <input type="tel" id="pos-phone" required placeholder="ุฑูู ุงูุฌูุงู">
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
       <div class="form-group"><label for="pos-capital">ุฑุฃุณ ุงููุงู ($)</label> <input type="number" id="pos-capital" min="0" step="0.01" required placeholder="0.00" oninput="updatePOSProfit()">
       </div>
       <div class="form-group"><label for="pos-tenant-price">ุณุนุฑ ุงููุณุชุฃุฌุฑ ($)</label> <input type="number" id="pos-tenant-price" min="0" step="0.01" required placeholder="0.00" oninput="updatePOSProfit()">
       </div>
      </div>
      <div class="form-group"><label for="pos-invoices-deduction">ุงูููุงุชูุฑ ุงููุฎุตููุฉ ($)</label> <input type="number" id="pos-invoices-deduction" min="0" step="0.01" value="0" placeholder="0.00" oninput="updatePOSProfit()">
      </div>
      <div class="form-group"><label for="pos-profit" style="font-size: 1.125rem; font-weight: bold; color: #1f2937;">ูููุฉ ุงูุฑุจุญ ($)</label> <input type="text" id="pos-profit" readonly style="background: #f3f4f6; font-size: 1.25rem; font-weight: bold; color: #059669;" placeholder="0.00 $">
      </div>
      <div class="form-group"><label for="pos-paid">ุญุงูุฉ ุงูุฏูุน</label> <select id="pos-paid" required onchange="updatePaymentDate()"> <option value="unpaid">โ ุบูุฑ ูุฏููุนุฉ</option> <option value="paid">โ ูุฏููุนุฉ</option> </select>
      </div>
      <div class="form-group" id="pos-payment-date-group" style="display: none;"><label for="pos-payment-date">ุชุงุฑูุฎ ุงูุฏูุน</label> <input type="date" id="pos-payment-date">
      </div>
      <div class="form-group"><label for="pos-notes">ููุงุญุธุงุช</label> <textarea id="pos-notes" rows="2" placeholder="ููุงุญุธุงุช ุฅุถุงููุฉ"></textarea>
      </div>
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem;"><button type="submit" class="btn-primary" style="flex: 1;">ุญูุธ</button> <button type="button" class="btn-secondary" style="flex: 1;" onclick="closeModal('pos-modal')">ุฅูุบุงุก</button>
      </div>
     </form>
    </div>
   </div>
  </div>
  <script>
    // Authentication System
    const ADMIN_CREDENTIALS = {
      username: 'admin',
      password: 'admin'
    };
    
    // Check authentication status
    function checkAuth() {
      const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';
      if (isAuthenticated) {
        showApp();
      } else {
        showLogin();
      }
    }
    
    // Show login screen
    function showLogin() {
      document.getElementById('login-screen').style.display = 'flex';
      document.getElementById('app').style.display = 'none';
    }
    
    // Show main application
    function showApp() {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('app').style.display = 'block';
    }
    
    // Handle login form submission
    function handleLogin(event) {
      event.preventDefault();
      
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value.trim();
      const errorDiv = document.getElementById('login-error');
      
      // Debug: log the values (remove in production)
      console.log('Username entered:', username);
      console.log('Password entered:', password);
      console.log('Expected username:', ADMIN_CREDENTIALS.username);
      console.log('Expected password:', ADMIN_CREDENTIALS.password);
      
      if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
        // Login successful
        localStorage.setItem('isAuthenticated', 'true');
        localStorage.setItem('loginTime', new Date().toISOString());
        errorDiv.style.display = 'none';
        showApp();
        // Initialize the app after successful login
        setTimeout(() => {
          init();
        }, 100);
      } else {
        // Login failed
        errorDiv.textContent = 'ุงุณู ุงููุณุชุฎุฏู ุฃู ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ. ุงุณุชุฎุฏู: admin / admin';
        errorDiv.style.display = 'block';
        document.getElementById('login-password').value = '';
      }
    }
    
    // Handle logout
    function handleLogout() {
      if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุชุณุฌูู ุงูุฎุฑูุฌุ')) {
        localStorage.removeItem('isAuthenticated');
        localStorage.removeItem('loginTime');
        showLogin();
        document.getElementById('login-form').reset();
        document.getElementById('login-error').style.display = 'none';
      }
    }
    
    // Initialize authentication check on page load
    checkAuth();
    
    let allData = [];
    
    const defaultConfig = {
      system_title: "ูุธุงู ุชุดุบูู ุงูุดูู",
      default_checkin_time: "3:00 PM",
      default_checkout_time: "11:00 AM",
      background_color: "#f3f4f6",
      surface_color: "#ffffff",
      text_color: "#1f2937",
      primary_action_color: "#3b82f6",
      secondary_action_color: "#6b7280"
    };
    
    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        updateDashboard();
        renderActiveTab();
      }
    };
    
    async function init() {
      // Check authentication before initializing
      const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';
      if (!isAuthenticated) {
        showLogin();
        return;
      }
      
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        showToast("ูุดู ุชุญููู ุงููุธุงู");
        return;
      }
      
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            const systemTitle = document.getElementById('system-title');
            if (systemTitle) {
              systemTitle.textContent = config.system_title || defaultConfig.system_title;
            }
            
            const background = config.background_color || defaultConfig.background_color;
            const surface = config.surface_color || defaultConfig.surface_color;
            const text = config.text_color || defaultConfig.text_color;
            const primary = config.primary_action_color || defaultConfig.primary_action_color;
            const secondary = config.secondary_action_color || defaultConfig.secondary_action_color;
            
            document.getElementById('app').style.background = background;
            
            const cards = document.querySelectorAll('.card, .stat-card, .modal-content');
            cards.forEach(card => card.style.background = surface);
            
            const tables = document.querySelectorAll('table');
            tables.forEach(table => table.style.background = surface);
            
            document.body.style.color = text;
            
            const primaryButtons = document.querySelectorAll('.btn-primary');
            primaryButtons.forEach(btn => btn.style.background = primary);
            
            const secondaryButtons = document.querySelectorAll('.btn-secondary');
            secondaryButtons.forEach(btn => btn.style.background = secondary);
            
            const activeTabs = document.querySelectorAll('.tab-button.active');
            activeTabs.forEach(tab => {
              tab.style.color = primary;
              tab.style.borderBottomColor = primary;
            });
          },
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  config.primary_action_color = value;
                  window.elementSdk.setConfig({ primary_action_color: value });
                }
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  config.secondary_action_color = value;
                  window.elementSdk.setConfig({ secondary_action_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (config) => new Map([
            ["system_title", config.system_title || defaultConfig.system_title],
            ["default_checkin_time", config.default_checkin_time || defaultConfig.default_checkin_time],
            ["default_checkout_time", config.default_checkout_time || defaultConfig.default_checkout_time]
          ])
        });
      }
      
      setupTabs();
      updateDashboard();
    }
    
    function setupTabs() {
      const tabButtons = document.querySelectorAll('.tab-button');
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          tabButtons.forEach(btn => {
            btn.classList.remove('active');
            btn.style.color = '#6b7280';
            btn.style.borderBottomColor = 'transparent';
          });
          
          button.classList.add('active');
          button.style.color = '#3b82f6';
          button.style.borderBottomColor = '#3b82f6';
          
          const tabContents = document.querySelectorAll('.tab-content');
          tabContents.forEach(content => content.style.display = 'none');
          
          const tabId = button.dataset.tab + '-tab';
          const activeTab = document.getElementById(tabId);
          if (activeTab) {
            activeTab.style.display = 'block';
            renderActiveTab();
          }
        });
      });
    }
    
    function renderActiveTab() {
      const activeTab = document.querySelector('.tab-button.active');
      if (!activeTab) return;
      
      const tab = activeTab.dataset.tab;
      
      switch(tab) {
        case 'dashboard':
          updateDashboard();
          break;
        case 'bookings':
          renderBookings();
          break;
        case 'units':
          renderUnits();
          break;
        case 'cleaning':
          renderCleaning();
          break;
        case 'inspection':
          renderInspection();
          break;
        case 'inventory':
          renderInventory();
          break;
        case 'delivery':
          renderDelivery();
          break;
        case 'maintenance':
          renderMaintenance();
          break;
        case 'invoices':
          renderInvoices();
          break;
        case 'pos':
          renderPOS();
          break;
      }
    }
    
    function updateDashboard() {
      const units = allData.filter(d => d.type === 'unit');
      const bookings = allData.filter(d => d.type === 'booking');
      const cleaning = allData.filter(d => d.type === 'cleaning');
      const inventory = allData.filter(d => d.type === 'inventory');
      
      const readyUnits = units.filter(u => u.unit_status === 'Ready').length;
      const needsCleaning = units.filter(u => u.unit_status === 'Needs Cleaning').length;
      
      const today = new Date().toISOString().split('T')[0];
      const checkinsToday = bookings.filter(b => b.checkin_date === today).length;
      const checkoutsToday = bookings.filter(b => b.checkout_date === today).length;
      
      const pendingTasks = cleaning.filter(c => c.cleaning_status === 'Pending' || c.cleaning_status === 'In Progress').length;
      
      document.getElementById('ready-count').textContent = readyUnits;
      document.getElementById('cleaning-count').textContent = needsCleaning;
      document.getElementById('checkin-count').textContent = checkinsToday;
      document.getElementById('checkout-count').textContent = checkoutsToday;
      document.getElementById('tasks-count').textContent = pendingTasks;
      
      const todayBookings = bookings.filter(b => b.checkin_date === today || b.checkout_date === today);
      const todayBookingsDiv = document.getElementById('today-bookings');
      if (todayBookings.length === 0) {
        todayBookingsDiv.innerHTML = '<p style="color: #6b7280;">ูุง ุชูุฌุฏ ุญุฌูุฒุงุช ููููู</p>';
      } else {
        todayBookingsDiv.innerHTML = todayBookings.map(b => `
          <div style="padding: 1rem; border: 2px solid #e5e7eb; border-radius: 8px; margin-bottom: 0.5rem;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <strong>${b.guest_name}</strong> - ${b.location} ${b.unit_number}
              </div>
              <div>
                ${b.checkin_date === today ? 'โฌ๏ธ ุฏุฎูู' : 'โก๏ธ ุฎุฑูุฌ'}
              </div>
            </div>
          </div>
        `).join('');
      }
      
      const lowInventory = inventory.filter(i => i.needs_refill);
      const lowInventoryDiv = document.getElementById('low-inventory');
      if (lowInventory.length === 0) {
        lowInventoryDiv.innerHTML = '<p style="color: #6b7280;">ุฌููุน ุงููุณุชูุฒูุงุช ูุชููุฑุฉ</p>';
      } else {
        lowInventoryDiv.innerHTML = lowInventory.map(i => `
          <div style="padding: 1rem; border: 2px solid #fbbf24; border-radius: 8px; margin-bottom: 0.5rem; background: #fef3c7;">
            <strong>${i.item_name}</strong> - ${i.location} ${i.unit_number}<br>
            <span style="color: #92400e;">ุงููููุฉ: ${i.current_quantity} / ุงูุญุฏ ุงูุฃุฏูู: ${i.minimum_quantity}</span>
          </div>
        `).join('');
      }
    }
    
    function renderBookings() {
      const bookings = allData.filter(d => d.type === 'booking');
      const tbody = document.getElementById('bookings-body');
      
      if (bookings.length === 0) {
        tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: #6b7280;">ูุง ุชูุฌุฏ ุญุฌูุฒุงุช</td></tr>';
        return;
      }
      
      tbody.innerHTML = bookings.map(b => `
        <tr>
          <td>${b.location}</td>
          <td>${b.unit_number}</td>
          <td>${b.guest_name}</td>
          <td>${b.guest_phone}</td>
          <td>${b.checkin_date} ${b.checkin_time}</td>
          <td>${b.checkout_date} ${b.checkout_time}</td>
          <td>${b.guest_count}</td>
          <td style="max-width: 200px; word-wrap: break-word;">${b.guest_address || '-'}</td>
          <td>${getBookingStatusBadge(b.booking_status)}</td>
          <td>
            <button class="btn-danger" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="deleteBooking('${b.__backendId}')">ุญุฐู</button>
          </td>
        </tr>
      `).join('');
    }
    
    function renderUnits() {
      const units = allData.filter(d => d.type === 'unit');
      const tbody = document.getElementById('units-body');
      
      // Update total units count
      const totalUnitsCount = document.getElementById('total-units-count');
      if (totalUnitsCount) {
        totalUnitsCount.textContent = units.length;
      }
      
      if (units.length === 0) {
        tbody.innerHTML = '<tr><td colspan="11" style="text-align: center; color: #6b7280;">ูุง ุชูุฌุฏ ุดูู</td></tr>';
        return;
      }
      
      tbody.innerHTML = units.map(u => `
        <tr>
          <td>${u.location}</td>
          <td>${u.unit_number}</td>
          <td>${u.unit_type}</td>
          <td>${u.tenant_name || '-'}</td>
          <td>${u.tenant_phone || '-'}</td>
          <td>${u.occupants_count || 0}</td>
          <td>${u.id_image ? `<button class="btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="viewUnitIdImage('${u.__backendId}')">๐๏ธ ุนุฑุถ</button>` : '-'}</td>
          <td>${getUnitStatusBadge(u.unit_status)}</td>
          <td>${u.last_cleaning || '-'}</td>
          <td>${u.unit_status === 'Ready' ? 'โ' : 'โ'}</td>
          <td>
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="editUnit('${u.__backendId}')">ุชุนุฏูู</button>
              <button class="btn-danger" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="deleteUnit('${u.__backendId}')">ุญุฐู</button>
            </div>
          </td>
        </tr>
      `).join('');
    }
    
    function renderCleaning() {
      const cleaning = allData.filter(d => d.type === 'cleaning');
      const tbody = document.getElementById('cleaning-body');
      
      if (cleaning.length === 0) {
        tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #6b7280;">ูุง ุชูุฌุฏ ููุงู ุชูุธูู</td></tr>';
        return;
      }
      
      tbody.innerHTML = cleaning.map(c => `
        <tr>
          <td>${c.location}</td>
          <td>${c.unit_number}</td>
          <td>${c.cleaning_reason}</td>
          <td>${c.cleaning_date}</td>
          <td>${c.start_time}</td>
          <td>${c.end_time || '-'}</td>
          <td>${c.cleaner_name || '-'}</td>
          <td>${getCleaningStatusBadge(c.cleaning_status)}</td>
          <td>
            <button class="btn-danger" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="deleteCleaning('${c.__backendId}')">ุญุฐู</button>
          </td>
        </tr>
      `).join('');
    }
    
    function renderInspection() {
      const inspections = allData.filter(d => d.type === 'inspection');
      const tbody = document.getElementById('inspection-body');
      
      if (inspections.length === 0) {
        tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #6b7280;">ูุง ุชูุฌุฏ ุชูุชูุดุงุช</td></tr>';
        return;
      }
      
      tbody.innerHTML = inspections.map(i => `
        <tr>
          <td>${i.location}</td>
          <td>${i.unit_number}</td>
          <td>${i.inspection_date}</td>
          <td>${i.wifi_ok ? 'โ' : 'โ'}</td>
          <td>${i.cleanliness_ok ? 'โ' : 'โ'}</td>
          <td>${i.supplies_ok ? 'โ' : 'โ'}</td>
          <td>${i.inspection_notes || '-'}</td>
          <td>${i.approved ? 'โ' : 'โ'}</td>
          <td>
            <button class="btn-danger" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="deleteInspection('${i.__backendId}')">ุญุฐู</button>
          </td>
        </tr>
      `).join('');
    }
    
    function renderInventory() {
      let inventory = allData.filter(d => d.type === 'inventory');
      
      const locationFilter = document.getElementById('filter-location').value;
      const unitFilter = document.getElementById('filter-unit').value;
      const categoryFilter = document.getElementById('filter-category').value;
      const needsRefillOnly = document.getElementById('filter-needs-refill').checked;
      
      if (locationFilter) {
        inventory = inventory.filter(i => i.location === locationFilter);
      }
      if (unitFilter) {
        inventory = inventory.filter(i => i.unit_number === unitFilter);
      }
      if (categoryFilter) {
        inventory = inventory.filter(i => i.category === categoryFilter);
      }
      if (needsRefillOnly) {
        inventory = inventory.filter(i => i.needs_refill);
      }
      
      updateFilterUnits();
      
      const tbody = document.getElementById('inventory-body');
      
      if (inventory.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #6b7280;">ูุง ุชูุฌุฏ ุฃุตูุงู</td></tr>';
        return;
      }
      
      inventory.sort((a, b) => {
        if (a.location !== b.location) return a.location.localeCompare(b.location);
        if (a.unit_number !== b.unit_number) return a.unit_number.localeCompare(b.unit_number);
        return a.category.localeCompare(b.category);
      });
      
      tbody.innerHTML = inventory.map(i => {
        const statusColor = i.needs_refill ? '#fbbf24' : '#10b981';
        const statusBg = i.needs_refill ? '#fef3c7' : '#d1fae5';
        const statusText = i.needs_refill ? 'ูุญุชุงุฌ ุชุนุจุฆุฉ' : 'ูุชููุฑ';
        const categoryIcon = getCategoryIcon(i.category);
        
        return `
        <tr style="${i.needs_refill ? 'background: #fffbeb;' : ''}">
          <td>${i.location}</td>
          <td>${i.unit_number}</td>
          <td>${categoryIcon} ${i.category}</td>
          <td><strong>${i.item_name}</strong></td>
          <td><span style="font-size: 1.25rem; font-weight: bold; color: ${i.needs_refill ? '#dc2626' : '#059669'}">${i.current_quantity}</span></td>
          <td><span style="color: #6b7280;">${i.minimum_quantity}</span></td>
          <td><span class="status-badge" style="background: ${statusBg}; color: ${statusColor === '#fbbf24' ? '#92400e' : '#065f46'}">${statusText}</span></td>
          <td>
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="openUpdateQuantity('${i.__backendId}')">ุชุญุฏูุซ</button>
              <button class="btn-danger" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="deleteInventory('${i.__backendId}')">ุญุฐู</button>
            </div>
          </td>
        </tr>
      `}).join('');
    }
    
    function getCategoryIcon(category) {
      const icons = {
        'Bedroom': '๐๏ธ',
        'Bathroom': '๐ฟ',
        'Kitchen': '๐ฝ๏ธ',
        'Cleaning Supplies': '๐งผ',
        'Guest Essentials': 'โจ'
      };
      return icons[category] || '๐ฆ';
    }
    
    function updateFilterUnits() {
      const locationFilter = document.getElementById('filter-location').value;
      const unitFilter = document.getElementById('filter-unit');
      
      const inventory = allData.filter(d => d.type === 'inventory');
      let filteredInventory = inventory;
      
      if (locationFilter) {
        filteredInventory = inventory.filter(i => i.location === locationFilter);
      }
      
      const uniqueUnits = [...new Set(filteredInventory.map(i => i.unit_number))].sort();
      
      const currentValue = unitFilter.value;
      unitFilter.innerHTML = '<option value="">ุฌููุน ุงูุดูู</option>' + 
        uniqueUnits.map(u => `<option value="${u}" ${u === currentValue ? 'selected' : ''}>${u}</option>`).join('');
    }
    
    function getBookingStatusBadge(status) {
      const colors = {
        'Upcoming': 'background: #dbeafe; color: #1e40af',
        'Checked-in': 'background: #d1fae5; color: #065f46',
        'Checked-out': 'background: #fef3c7; color: #92400e',
        'Cancelled': 'background: #fee2e2; color: #991b1b',
        'Completed': 'background: #e5e7eb; color: #374151'
      };
      return `<span class="status-badge" style="${colors[status] || ''}">${status}</span>`;
    }
    
    function getUnitStatusBadge(status) {
      const colors = {
        'Needs Cleaning': 'background: #fee2e2; color: #991b1b',
        'Cleaning': 'background: #fef3c7; color: #92400e',
        'Inspection': 'background: #dbeafe; color: #1e40af',
        'Ready': 'background: #d1fae5; color: #065f46',
        'Maintenance': 'background: #fce7f3; color: #831843'
      };
      return `<span class="status-badge" style="${colors[status] || ''}">${status}</span>`;
    }
    
    function getCleaningStatusBadge(status) {
      const colors = {
        'Pending': 'background: #fef3c7; color: #92400e',
        'In Progress': 'background: #dbeafe; color: #1e40af',
        'Done': 'background: #d1fae5; color: #065f46',
        'Approved': 'background: #e5e7eb; color: #374151'
      };
      return `<span class="status-badge" style="${colors[status] || ''}">${status}</span>`;
    }
    
    function openBookingModal() {
      document.getElementById('booking-modal').classList.add('active');
    }
    
    function openCleaningModal() {
      document.getElementById('cleaning-modal').classList.add('active');
    }
    
    function openInspectionModal() {
      document.getElementById('inspection-modal').classList.add('active');
    }
    
    function openInventoryModal() {
      document.getElementById('inventory-modal').classList.add('active');
    }
    
    function openSetupModal() {
      document.getElementById('setup-modal').classList.add('active');
    }
    
    let currentUpdateItem = null;
    
    function openUpdateQuantity(itemId) {
      const item = allData.find(d => d.__backendId === itemId);
      if (!item) return;
      
      currentUpdateItem = item;
      
      const infoDiv = document.getElementById('update-item-info');
      const categoryIcon = getCategoryIcon(item.category);
      infoDiv.innerHTML = `
        <div style="margin-bottom: 0.5rem;"><strong>ุงููููุน:</strong> ${item.location}</div>
        <div style="margin-bottom: 0.5rem;"><strong>ุงูุดูุฉ:</strong> ${item.unit_number}</div>
        <div style="margin-bottom: 0.5rem;"><strong>ุงููุฆุฉ:</strong> ${categoryIcon} ${item.category}</div>
        <div style="margin-bottom: 0.5rem;"><strong>ุงูุตูู:</strong> ${item.item_name}</div>
        <div><strong>ุงููููุฉ ุงูุญุงููุฉ:</strong> <span style="font-size: 1.25rem; font-weight: bold; color: ${item.needs_refill ? '#dc2626' : '#059669'}">${item.current_quantity}</span></div>
      `;
      
      document.getElementById('new-quantity').value = item.current_quantity;
      document.getElementById('update-quantity-modal').classList.add('active');
    }
    
    async function saveQuantityUpdate(event) {
      event.preventDefault();
      
      if (!currentUpdateItem) return;
      
      const form = event.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ุฌุงุฑู ุงูุชุญุฏูุซ...';
      
      const newQuantity = parseInt(document.getElementById('new-quantity').value);
      
      currentUpdateItem.current_quantity = newQuantity;
      currentUpdateItem.needs_refill = newQuantity < currentUpdateItem.minimum_quantity;
      
      const result = await window.dataSdk.update(currentUpdateItem);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'ุญูุธ';
      
      if (result.isOk) {
        showToast('ุชู ุชุญุฏูุซ ุงููููุฉ ุจูุฌุงุญ');
        closeModal('update-quantity-modal');
        currentUpdateItem = null;
      } else {
        showToast('ูุดู ุชุญุฏูุซ ุงููููุฉ');
      }
    }
    
    async function setupUnitInventory(event) {
      event.preventDefault();
      
      const form = event.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ุฌุงุฑู ุงูุฅุนุฏุงุฏ...';
      
      const location = document.getElementById('setup-location').value;
      const unitNumber = document.getElementById('setup-unit').value;
      
      const standardItems = [
        { category: 'Bedroom', item: 'Bed Sheets Sets', current: 2, min: 2 },
        { category: 'Bedroom', item: 'Pillows', current: 4, min: 4 },
        { category: 'Bedroom', item: 'Extra Blanket', current: 1, min: 1 },
        { category: 'Bedroom', item: 'Hangers', current: 15, min: 10 },
        
        { category: 'Bathroom', item: 'Bath Towels', current: 4, min: 4 },
        { category: 'Bathroom', item: 'Hand Towels', current: 4, min: 4 },
        { category: 'Bathroom', item: 'Bath Mat', current: 2, min: 2 },
        { category: 'Bathroom', item: 'Shampoo Bottles', current: 2, min: 2 },
        { category: 'Bathroom', item: 'Conditioner Bottles', current: 2, min: 2 },
        { category: 'Bathroom', item: 'Hand Soap', current: 2, min: 2 },
        { category: 'Bathroom', item: 'Hair Dryer', current: 1, min: 1 },
        { category: 'Bathroom', item: 'Trash Bags Roll', current: 1, min: 1 },
        
        { category: 'Kitchen', item: 'Dinner Plates', current: 8, min: 8 },
        { category: 'Kitchen', item: 'Cups/Mugs', current: 8, min: 8 },
        { category: 'Kitchen', item: 'Cutlery Set', current: 8, min: 8 },
        { category: 'Kitchen', item: 'Cooking Pots', current: 2, min: 2 },
        { category: 'Kitchen', item: 'Frying Pan', current: 1, min: 1 },
        { category: 'Kitchen', item: 'Electric Kettle', current: 1, min: 1 },
        { category: 'Kitchen', item: 'Coffee Machine', current: 1, min: 1 },
        { category: 'Kitchen', item: 'Coffee Packs', current: 3, min: 2 },
        { category: 'Kitchen', item: 'Tea Bags Box', current: 1, min: 1 },
        { category: 'Kitchen', item: 'Sugar Pack', current: 1, min: 1 },
        
        { category: 'Cleaning Supplies', item: 'Floor Cleaner Bottle', current: 1, min: 1 },
        { category: 'Cleaning Supplies', item: 'Disinfectant Spray', current: 1, min: 1 },
        { category: 'Cleaning Supplies', item: 'Mop', current: 1, min: 1 },
        { category: 'Cleaning Supplies', item: 'Broom', current: 1, min: 1 },
        { category: 'Cleaning Supplies', item: 'Sponges Pack', current: 1, min: 1 },
        { category: 'Cleaning Supplies', item: 'Cleaning Gloves', current: 2, min: 2 },
        
        { category: 'Guest Essentials', item: 'Toilet Paper Rolls', current: 6, min: 4 },
        { category: 'Guest Essentials', item: 'Paper Towels Roll', current: 2, min: 2 },
        { category: 'Guest Essentials', item: 'Tissues Box', current: 2, min: 2 }
      ];
      
      const currentInventoryCount = allData.filter(d => d.type === 'inventory').length;
      if (currentInventoryCount + standardItems.length > 999) {
        showToast('ูุง ูููู ุฅุถุงูุฉ ุฌููุน ุงููุณุชูุฒูุงุช - ุงูุญุฏ ุงูุฃูุตู 999 ุตูู');
        submitBtn.disabled = false;
        submitBtn.textContent = 'โก ุฅุนุฏุงุฏ ุงูุดูุฉ';
        return;
      }
      
      let successCount = 0;
      for (const item of standardItems) {
        const inventoryData = {
          type: 'inventory',
          location: location,
          unit_number: unitNumber,
          category: item.category,
          item_name: item.item,
          current_quantity: item.current,
          minimum_quantity: item.min,
          needs_refill: item.current < item.min,
          timestamp: new Date().toISOString()
        };
        
        const result = await window.dataSdk.create(inventoryData);
        if (result.isOk) {
          successCount++;
        }
      }
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'โก ุฅุนุฏุงุฏ ุงูุดูุฉ';
      
      if (successCount === standardItems.length) {
        showToast(`ุชู ุฅุนุฏุงุฏ ุงูุดูุฉ ุจูุฌุงุญ! ุชู ุฅุถุงูุฉ ${successCount} ุตูู`);
        closeModal('setup-modal');
        form.reset();
      } else if (successCount > 0) {
        showToast(`ุชู ุฅุถุงูุฉ ${successCount} ูู ${standardItems.length} ุตูู`);
      } else {
        showToast('ูุดู ุฅุนุฏุงุฏ ุงูุดูุฉ');
      }
    }
    
    async function importAllProperties() {
      if (!confirm('ูู ุชุฑูุฏ ุงุณุชูุฑุงุฏ ุฌููุน ุงูุนูุงุฑุงุช ูู ุงููุงุฆูุฉุ ุณูุชู ุฅุถุงูุฉ ุฌููุน ุงูุดูู ุงููุฐููุฑุฉ.')) {
        return;
      }
      
      // All properties from the spreadsheet
      const properties = [
        // Aster
        { location: 'aster', unit_number: '150' },
        { location: 'aster', unit_number: '145' },
        { location: 'aster', unit_number: '424' },
        { location: 'aster', unit_number: '350' },
        { location: 'aster', unit_number: '345' },
        
        // Lamont
        { location: 'lumont', unit_number: '106' },
        { location: 'lumont', unit_number: '206' },
        { location: 'lumont', unit_number: '305' },
        { location: 'lumont', unit_number: '406' },
        { location: 'lumont', unit_number: '408' },
        
        // Lumos
        { location: 'lumos', unit_number: '305' },
        
        // Sky
        { location: 'sky', unit_number: '641' },
        { location: 'sky', unit_number: '642' },
        
        // Vantage
        { location: 'vantage', unit_number: 'B1-PH1' },
        { location: 'vantage', unit_number: 'B1-707' },
        { location: 'vantage', unit_number: 'B1-703' },
        { location: 'vantage', unit_number: 'B1-403' },
        { location: 'vantage', unit_number: 'B1-203' },
        { location: 'vantage', unit_number: 'B1-306' },
        { location: 'vantage', unit_number: 'B1-301' },
        { location: 'vantage', unit_number: 'B1-205' },
        { location: 'vantage', unit_number: 'B1-604' },
        { location: 'vantage', unit_number: 'B1-104' },
        { location: 'vantage', unit_number: 'B2-PH3' },
        { location: 'vantage', unit_number: 'B2-606' },
        { location: 'vantage', unit_number: 'B2-721' },
        { location: 'vantage', unit_number: 'B2-418' },
        { location: 'vantage', unit_number: 'B2-412' },
        { location: 'vantage', unit_number: 'B3-805' },
        { location: 'vantage', unit_number: 'B3-105' },
        { location: 'vantage', unit_number: 'B3-316' },
        { location: 'vantage', unit_number: 'B3-501' },
        { location: 'vantage', unit_number: 'B3-814' },
        { location: 'vantage', unit_number: 'B4-PH2' },
        { location: 'vantage', unit_number: 'B4-PH8' },
        { location: 'vantage', unit_number: 'B4-416' },
        { location: 'vantage', unit_number: 'B4-616' },
        { location: 'vantage', unit_number: 'B4-503' },
        { location: 'vantage', unit_number: 'B4-402' }
      ];
      
      // Check existing units to avoid duplicates
      const existingUnits = allData.filter(d => d.type === 'unit');
      const existingKeys = new Set(existingUnits.map(u => `${u.location}-${u.unit_number}`));
      
      // Filter out existing units
      const newProperties = properties.filter(p => {
        const key = `${p.location}-${p.unit_number}`;
        return !existingKeys.has(key);
      });
      
      if (newProperties.length === 0) {
        showToast('ุฌููุน ุงูุนูุงุฑุงุช ููุฌูุฏุฉ ุจุงููุนู ูู ุงููุธุงู');
        return;
      }
      
      if (existingUnits.length + newProperties.length > 999) {
        showToast(`ูุง ูููู ุฅุถุงูุฉ ุฌููุน ุงูุนูุงุฑุงุช - ุงูุญุฏ ุงูุฃูุตู 999 ุดูุฉ`);
        return;
      }
      
      // Show progress
      showToast(`ุฌุงุฑู ุฅุถุงูุฉ ${newProperties.length} ุดูุฉ...`);
      
      let successCount = 0;
      let failCount = 0;
      
      for (const prop of newProperties) {
        const unitData = {
          type: 'unit',
          location: prop.location,
          unit_number: prop.unit_number,
          unit_type: 'Studio', // Default type, can be updated later
          tenant_name: null,
          tenant_phone: null,
          occupants_count: 0,
          id_image: null,
          unit_status: 'Ready',
          last_cleaning: new Date().toISOString().split('T')[0],
          timestamp: new Date().toISOString()
        };
        
        const result = await window.dataSdk.create(unitData);
        if (result.isOk) {
          successCount++;
        } else {
          failCount++;
        }
      }
      
      showToast(`ุชู ุฅุถุงูุฉ ${successCount} ุดูุฉ ุจูุฌุงุญ${failCount > 0 ? `ุ ูุดู ุฅุถุงูุฉ ${failCount} ุดูุฉ` : ''}`);
    }
    
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }
    
    async function saveBooking(event) {
      event.preventDefault();
      
      if (allData.filter(d => d.type === 'booking').length >= 999) {
        showToast("ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู ูู ุงูุญุฌูุฒุงุช (999)");
        return;
      }
      
      const form = event.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
      
      const bookingData = {
        type: 'booking',
        location: document.getElementById('booking-location').value,
        unit_number: document.getElementById('booking-unit').value,
        guest_name: document.getElementById('booking-guest').value,
        guest_phone: document.getElementById('booking-phone').value,
        guest_address: document.getElementById('booking-address').value || null,
        checkin_date: document.getElementById('booking-checkin-date').value,
        checkin_time: document.getElementById('booking-checkin-time').value,
        checkout_date: document.getElementById('booking-checkout-date').value,
        checkout_time: document.getElementById('booking-checkout-time').value,
        guest_count: parseInt(document.getElementById('booking-guests').value),
        booking_status: 'Upcoming',
        timestamp: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(bookingData);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'ุญูุธ';
      
      if (result.isOk) {
        showToast('ุชู ุฅุถุงูุฉ ุงูุญุฌุฒ ุจูุฌุงุญ');
        closeModal('booking-modal');
        form.reset();
      } else {
        showToast('ูุดู ุญูุธ ุงูุญุฌุฒ');
      }
    }
    
    let unitIdImageBase64 = null;
    let currentEditUnit = null;
    
    function handleUnitIdImage(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (!file.type.startsWith('image/')) {
        showToast('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ููู ุตูุฑุฉ');
        event.target.value = '';
        return;
      }
      
      if (file.size > 5 * 1024 * 1024) {
        showToast('ุญุฌู ุงูุตูุฑุฉ ูุจูุฑ ุฌุฏุงู (ุงูุญุฏ ุงูุฃูุตู 5MB)');
        event.target.value = '';
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        unitIdImageBase64 = e.target.result;
        const preview = document.getElementById('unit-id-image-preview');
        const previewImg = document.getElementById('unit-id-preview-img');
        previewImg.src = unitIdImageBase64;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(file);
    }
    
    function clearUnitIdImage() {
      unitIdImageBase64 = null;
      document.getElementById('unit-id-image').value = '';
      document.getElementById('unit-id-image-preview').style.display = 'none';
    }
    
    function viewUnitIdImage(id) {
      const unit = allData.find(d => d.__backendId === id);
      if (!unit || !unit.id_image) return;
      
      const newWindow = window.open();
      newWindow.document.write(`<html><head><title>ุตูุฑุฉ ุงูุฌูุงุฒ/ุงููููุฉ</title></head><body style="margin:0;display:flex;justify-content:center;align-items:center;height:100vh;background:#f3f4f6;"><img src="${unit.id_image}" style="max-width:90%;max-height:90%;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.3);"></body></html>`);
    }
    
    function openUnitModal() {
      document.getElementById('unit-form').reset();
      unitIdImageBase64 = null;
      currentEditUnit = null;
      document.getElementById('unit-id-image-preview').style.display = 'none';
      document.getElementById('unit-occupants').value = 0;
      document.getElementById('unit-modal').classList.add('active');
    }
    
    function editUnit(id) {
      const unit = allData.find(d => d.__backendId === id);
      if (!unit) return;
      
      currentEditUnit = unit;
      unitIdImageBase64 = unit.id_image || null;
      
      document.getElementById('unit-location').value = unit.location || '';
      document.getElementById('unit-number').value = unit.unit_number || '';
      document.getElementById('unit-type').value = unit.unit_type || '';
      document.getElementById('unit-tenant').value = unit.tenant_name || '';
      document.getElementById('unit-phone').value = unit.tenant_phone || '';
      document.getElementById('unit-occupants').value = unit.occupants_count || 0;
      
      if (unitIdImageBase64) {
        const preview = document.getElementById('unit-id-image-preview');
        const previewImg = document.getElementById('unit-id-preview-img');
        previewImg.src = unitIdImageBase64;
        preview.style.display = 'block';
      }
      
      document.getElementById('unit-modal').classList.add('active');
    }
    
    async function saveUnit(event) {
      event.preventDefault();
      
      if (allData.filter(d => d.type === 'unit').length >= 999 && !currentEditUnit) {
        showToast("ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู ูู ุงูุดูู (999)");
        return;
      }
      
      const form = event.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
      
      const unitData = {
        type: 'unit',
        location: document.getElementById('unit-location').value,
        unit_number: document.getElementById('unit-number').value,
        unit_type: document.getElementById('unit-type').value,
        tenant_name: document.getElementById('unit-tenant').value || null,
        tenant_phone: document.getElementById('unit-phone').value || null,
        occupants_count: parseInt(document.getElementById('unit-occupants').value) || 0,
        id_image: unitIdImageBase64 || null,
        unit_status: currentEditUnit ? (currentEditUnit.unit_status || 'Ready') : 'Ready',
        last_cleaning: currentEditUnit ? (currentEditUnit.last_cleaning || new Date().toISOString().split('T')[0]) : new Date().toISOString().split('T')[0],
        timestamp: new Date().toISOString()
      };
      
      let result;
      if (currentEditUnit) {
        unitData.__backendId = currentEditUnit.__backendId;
        result = await window.dataSdk.update(unitData);
      } else {
        result = await window.dataSdk.create(unitData);
      }
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'ุญูุธ';
      
      if (result.isOk) {
        showToast(currentEditUnit ? 'ุชู ุชุญุฏูุซ ุงูุดูุฉ ุจูุฌุงุญ' : 'ุชู ุฅุถุงูุฉ ุงูุดูุฉ ุจูุฌุงุญ');
        closeModal('unit-modal');
        form.reset();
        unitIdImageBase64 = null;
        document.getElementById('unit-id-image-preview').style.display = 'none';
        currentEditUnit = null;
      } else {
        showToast('ูุดู ุญูุธ ุงูุดูุฉ');
      }
    }
    
    async function saveCleaning(event) {
      event.preventDefault();
      
      if (allData.filter(d => d.type === 'cleaning').length >= 999) {
        showToast("ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู ูู ููุงู ุงูุชูุธูู (999)");
        return;
      }
      
      const form = event.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
      
      const cleaningData = {
        type: 'cleaning',
        location: document.getElementById('cleaning-location').value,
        unit_number: document.getElementById('cleaning-unit').value,
        cleaning_reason: document.getElementById('cleaning-reason').value,
        cleaning_date: document.getElementById('cleaning-date').value,
        start_time: document.getElementById('cleaning-start').value,
        end_time: document.getElementById('cleaning-end').value || null,
        cleaner_name: document.getElementById('cleaning-cleaner').value || null,
        cleaning_status: 'Pending',
        timestamp: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(cleaningData);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'ุญูุธ';
      
      if (result.isOk) {
        showToast('ุชู ุฅุถุงูุฉ ูููุฉ ุงูุชูุธูู ุจูุฌุงุญ');
        closeModal('cleaning-modal');
        form.reset();
      } else {
        showToast('ูุดู ุญูุธ ูููุฉ ุงูุชูุธูู');
      }
    }
    
    async function saveInspection(event) {
      event.preventDefault();
      
      if (allData.filter(d => d.type === 'inspection').length >= 999) {
        showToast("ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู ูู ุงูุชูุชูุดุงุช (999)");
        return;
      }
      
      const form = event.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
      
      const wifiOk = document.getElementById('inspection-wifi').checked;
      const cleanOk = document.getElementById('inspection-clean').checked;
      const suppliesOk = document.getElementById('inspection-supplies').checked;
      
      const inspectionData = {
        type: 'inspection',
        location: document.getElementById('inspection-location').value,
        unit_number: document.getElementById('inspection-unit').value,
        inspection_date: document.getElementById('inspection-date').value,
        wifi_ok: wifiOk,
        cleanliness_ok: cleanOk,
        supplies_ok: suppliesOk,
        inspection_notes: document.getElementById('inspection-notes').value || null,
        approved: wifiOk && cleanOk && suppliesOk,
        timestamp: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(inspectionData);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'ุญูุธ';
      
      if (result.isOk) {
        showToast('ุชู ุฅุถุงูุฉ ุงูุชูุชูุด ุจูุฌุงุญ');
        closeModal('inspection-modal');
        form.reset();
      } else {
        showToast('ูุดู ุญูุธ ุงูุชูุชูุด');
      }
    }
    
    async function saveInventory(event) {
      event.preventDefault();
      
      if (allData.filter(d => d.type === 'inventory').length >= 999) {
        showToast("ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู ูู ุงูุฃุตูุงู (999)");
        return;
      }
      
      const form = event.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
      
      const current = parseInt(document.getElementById('inventory-current').value);
      const minimum = parseInt(document.getElementById('inventory-minimum').value);
      
      const inventoryData = {
        type: 'inventory',
        location: document.getElementById('inventory-location').value,
        unit_number: document.getElementById('inventory-unit').value,
        category: document.getElementById('inventory-category').value,
        item_name: document.getElementById('inventory-item').value,
        current_quantity: current,
        minimum_quantity: minimum,
        needs_refill: current < minimum,
        timestamp: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(inventoryData);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'ุญูุธ';
      
      if (result.isOk) {
        showToast('ุชู ุฅุถุงูุฉ ุงูุตูู ุจูุฌุงุญ');
        closeModal('inventory-modal');
        form.reset();
      } else {
        showToast('ูุดู ุญูุธ ุงูุตูู');
      }
    }
    
    async function deleteBooking(id) {
      const booking = allData.find(d => d.__backendId === id);
      if (!booking) return;
      
      const result = await window.dataSdk.delete(booking);
      
      if (result.isOk) {
        showToast('ุชู ุญุฐู ุงูุญุฌุฒ');
      } else {
        showToast('ูุดู ุญุฐู ุงูุญุฌุฒ');
      }
    }
    
    async function deleteUnit(id) {
      const unit = allData.find(d => d.__backendId === id);
      if (!unit) return;
      
      const result = await window.dataSdk.delete(unit);
      
      if (result.isOk) {
        showToast('ุชู ุญุฐู ุงูุดูุฉ');
      } else {
        showToast('ูุดู ุญุฐู ุงูุดูุฉ');
      }
    }
    
    async function deleteCleaning(id) {
      const cleaning = allData.find(d => d.__backendId === id);
      if (!cleaning) return;
      
      const result = await window.dataSdk.delete(cleaning);
      
      if (result.isOk) {
        showToast('ุชู ุญุฐู ูููุฉ ุงูุชูุธูู');
      } else {
        showToast('ูุดู ุญุฐู ูููุฉ ุงูุชูุธูู');
      }
    }
    
    async function deleteInspection(id) {
      const inspection = allData.find(d => d.__backendId === id);
      if (!inspection) return;
      
      const result = await window.dataSdk.delete(inspection);
      
      if (result.isOk) {
        showToast('ุชู ุญุฐู ุงูุชูุชูุด');
      } else {
        showToast('ูุดู ุญุฐู ุงูุชูุชูุด');
      }
    }
    
    async function deleteInventory(id) {
      const inventory = allData.find(d => d.__backendId === id);
      if (!inventory) return;
      
      const result = await window.dataSdk.delete(inventory);
      
      if (result.isOk) {
        showToast('ุชู ุญุฐู ุงูุตูู');
      } else {
        showToast('ูุดู ุญุฐู ุงูุตูู');
      }
    }
    
    function renderDelivery() {
      const deliveries = allData.filter(d => d.type === 'delivery');
      const tbody = document.getElementById('delivery-body');
      
      if (deliveries.length === 0) {
        tbody.innerHTML = '<tr><td colspan="11" style="text-align: center; color: #6b7280;">ูุง ุชูุฌุฏ ุทูุจุงุช ุชูุตูู</td></tr>';
        return;
      }
      
      deliveries.sort((a, b) => {
        if (a.delivery_status === 'Pending' && b.delivery_status !== 'Pending') return -1;
        if (a.delivery_status !== 'Pending' && b.delivery_status === 'Pending') return 1;
        return new Date(b.timestamp) - new Date(a.timestamp);
      });
      
      tbody.innerHTML = deliveries.map(d => `
        <tr>
          <td><strong>${d.customer_name}</strong></td>
          <td>${d.customer_phone}</td>
          <td>${d.location}</td>
          <td>${d.unit_number}</td>
          <td style="max-width: 200px; word-wrap: break-word;">${d.delivery_address || '-'}</td>
          <td>${d.checkin_date}</td>
          <td>${d.checkin_time}</td>
          <td>${d.checkout_date} ${d.checkout_time}</td>
          <td>${getDeliveryStatusBadge(d.delivery_status)}</td>
          <td style="max-width: 150px; word-wrap: break-word;">${d.delivery_notes || '-'}</td>
          <td>
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="editDelivery('${d.__backendId}')">ุชุนุฏูู</button>
              <button class="btn-danger" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="deleteDelivery('${d.__backendId}')">ุญุฐู</button>
            </div>
          </td>
        </tr>
      `).join('');
      
      updateDeliveryBookingOptions();
    }
    
    function getDeliveryStatusBadge(status) {
      const colors = {
        'Pending': 'background: #fef3c7; color: #92400e',
        'Scheduled': 'background: #dbeafe; color: #1e40af',
        'In Transit': 'background: #fce7f3; color: #831843',
        'Delivered': 'background: #d1fae5; color: #065f46',
        'Cancelled': 'background: #fee2e2; color: #991b1b'
      };
      const labels = {
        'Pending': 'โณ ููุฏ ุงูุงูุชุธุงุฑ',
        'Scheduled': '๐ ูุฌุฏูู',
        'In Transit': '๐ ููุฏ ุงูุชูุตูู',
        'Delivered': 'โ ุชู ุงูุชูุตูู',
        'Cancelled': 'โ ููุบู'
      };
      return `<span class="status-badge" style="${colors[status] || ''}">${labels[status] || status}</span>`;
    }
    
    function updateDeliveryBookingOptions() {
      const bookingSelect = document.getElementById('delivery-booking');
      if (!bookingSelect) return;
      
      const bookings = allData.filter(d => d.type === 'booking');
      bookingSelect.innerHTML = '<option value="">ุงุฎุชุฑ ุญุฌุฒ (ุฃู ุงุชุฑูู ูุงุฑุบุงู ูุฅุถุงูุฉ ุฌุฏูุฏ)</option>' + 
        bookings.map(b => `<option value="${b.__backendId}">${b.guest_name} - ${b.location} ${b.unit_number} (${b.checkin_date})</option>`).join('');
    }
    
    function fillDeliveryFromBooking() {
      const bookingId = document.getElementById('delivery-booking').value;
      if (!bookingId) return;
      
      const booking = allData.find(d => d.__backendId === bookingId);
      if (!booking) return;
      
      document.getElementById('delivery-name').value = booking.guest_name || '';
      document.getElementById('delivery-phone').value = booking.guest_phone || '';
      document.getElementById('delivery-location').value = booking.location || '';
      document.getElementById('delivery-unit').value = booking.unit_number || '';
      document.getElementById('delivery-address').value = booking.guest_address || '';
      document.getElementById('delivery-checkin-date').value = booking.checkin_date || '';
      document.getElementById('delivery-checkin-time').value = booking.checkin_time || '';
      document.getElementById('delivery-checkout-date').value = booking.checkout_date || '';
      document.getElementById('delivery-checkout-time').value = booking.checkout_time || '';
    }
    
    function openDeliveryModal() {
      updateDeliveryBookingOptions();
      document.getElementById('delivery-form').reset();
      document.getElementById('delivery-booking').value = '';
      document.getElementById('delivery-modal').classList.add('active');
    }
    
    let currentEditDelivery = null;
    
    function editDelivery(id) {
      const delivery = allData.find(d => d.__backendId === id);
      if (!delivery) return;
      
      currentEditDelivery = delivery;
      updateDeliveryBookingOptions();
      
      document.getElementById('delivery-name').value = delivery.customer_name || '';
      document.getElementById('delivery-phone').value = delivery.customer_phone || '';
      document.getElementById('delivery-location').value = delivery.location || '';
      document.getElementById('delivery-unit').value = delivery.unit_number || '';
      document.getElementById('delivery-address').value = delivery.delivery_address || '';
      document.getElementById('delivery-checkin-date').value = delivery.checkin_date || '';
      document.getElementById('delivery-checkin-time').value = delivery.checkin_time || '';
      document.getElementById('delivery-checkout-date').value = delivery.checkout_date || '';
      document.getElementById('delivery-checkout-time').value = delivery.checkout_time || '';
      document.getElementById('delivery-status').value = delivery.delivery_status || 'Pending';
      document.getElementById('delivery-notes').value = delivery.delivery_notes || '';
      document.getElementById('delivery-booking').value = '';
      
      document.getElementById('delivery-modal').classList.add('active');
    }
    
    async function saveDelivery(event) {
      event.preventDefault();
      
      if (allData.filter(d => d.type === 'delivery').length >= 999 && !currentEditDelivery) {
        showToast("ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู ูู ุทูุจุงุช ุงูุชูุตูู (999)");
        return;
      }
      
      const form = event.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
      
      const deliveryData = {
        type: 'delivery',
        customer_name: document.getElementById('delivery-name').value,
        customer_phone: document.getElementById('delivery-phone').value,
        location: document.getElementById('delivery-location').value,
        unit_number: document.getElementById('delivery-unit').value,
        delivery_address: document.getElementById('delivery-address').value,
        checkin_date: document.getElementById('delivery-checkin-date').value,
        checkin_time: document.getElementById('delivery-checkin-time').value,
        checkout_date: document.getElementById('delivery-checkout-date').value,
        checkout_time: document.getElementById('delivery-checkout-time').value,
        delivery_status: document.getElementById('delivery-status').value,
        delivery_notes: document.getElementById('delivery-notes').value || null,
        booking_id: document.getElementById('delivery-booking').value || null,
        timestamp: new Date().toISOString()
      };
      
      let result;
      if (currentEditDelivery) {
        deliveryData.__backendId = currentEditDelivery.__backendId;
        result = await window.dataSdk.update(deliveryData);
      } else {
        result = await window.dataSdk.create(deliveryData);
      }
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'ุญูุธ';
      
      if (result.isOk) {
        showToast(currentEditDelivery ? 'ุชู ุชุญุฏูุซ ุทูุจ ุงูุชูุตูู ุจูุฌุงุญ' : 'ุชู ุฅุถุงูุฉ ุทูุจ ุงูุชูุตูู ุจูุฌุงุญ');
        closeModal('delivery-modal');
        form.reset();
        currentEditDelivery = null;
      } else {
        showToast('ูุดู ุญูุธ ุทูุจ ุงูุชูุตูู');
      }
    }
    
    async function deleteDelivery(id) {
      const delivery = allData.find(d => d.__backendId === id);
      if (!delivery) return;
      
      if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุทูุจ ุงูุชูุตููุ')) return;
      
      const result = await window.dataSdk.delete(delivery);
      
      if (result.isOk) {
        showToast('ุชู ุญุฐู ุทูุจ ุงูุชูุตูู');
      } else {
        showToast('ูุดู ุญุฐู ุทูุจ ุงูุชูุตูู');
      }
    }
    
    function renderMaintenance() {
      const maintenance = allData.filter(d => d.type === 'maintenance');
      const tbody = document.getElementById('maintenance-body');
      
      if (maintenance.length === 0) {
        tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: #6b7280;">ูุง ุชูุฌุฏ ุทูุจุงุช ุตูุงูุฉ</td></tr>';
        return;
      }
      
      maintenance.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      
      tbody.innerHTML = maintenance.map(m => `
        <tr>
          <td>${m.location}</td>
          <td>${m.unit_number}</td>
          <td>${m.maintenance_type}</td>
          <td style="max-width: 200px; word-wrap: break-word;">${m.description || '-'}</td>
          <td>${m.maintenance_date}</td>
          <td>${getMaintenanceStatusBadge(m.maintenance_status)}</td>
          <td>${m.assigned_to || '-'}</td>
          <td>${m.cost ? m.cost.toFixed(2) + ' ุฑ.ุณ' : '-'}</td>
          <td style="max-width: 150px; word-wrap: break-word;">${m.notes || '-'}</td>
          <td>
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="editMaintenance('${m.__backendId}')">ุชุนุฏูู</button>
              <button class="btn-danger" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="deleteMaintenance('${m.__backendId}')">ุญุฐู</button>
            </div>
          </td>
        </tr>
      `).join('');
    }
    
    function renderInvoices() {
      const invoices = allData.filter(d => d.type === 'invoice');
      const tbody = document.getElementById('invoices-body');
      
      if (invoices.length === 0) {
        tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: #6b7280;">ูุง ุชูุฌุฏ ููุงุชูุฑ</td></tr>';
        return;
      }
      
      invoices.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      
      tbody.innerHTML = invoices.map(inv => `
        <tr>
          <td><strong>${inv.invoice_number}</strong></td>
          <td>${inv.location}</td>
          <td>${inv.unit_number}</td>
          <td>${inv.invoice_type}</td>
          <td><strong>${inv.amount.toFixed(2)} ุฑ.ุณ</strong></td>
          <td>${inv.invoice_date}</td>
          <td>${getInvoiceStatusBadge(inv.invoice_status)}</td>
          <td>${inv.image ? `<button class="btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="viewInvoiceImage('${inv.__backendId}')">๐๏ธ ุนุฑุถ</button>` : '-'}</td>
          <td style="max-width: 150px; word-wrap: break-word;">${inv.notes || '-'}</td>
          <td>
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="editInvoice('${inv.__backendId}')">ุชุนุฏูู</button>
              <button class="btn-danger" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="deleteInvoice('${inv.__backendId}')">ุญุฐู</button>
            </div>
          </td>
        </tr>
      `).join('');
    }
    
    function getMaintenanceStatusBadge(status) {
      const colors = {
        'Pending': 'background: #fef3c7; color: #92400e',
        'In Progress': 'background: #dbeafe; color: #1e40af',
        'Completed': 'background: #d1fae5; color: #065f46',
        'Cancelled': 'background: #fee2e2; color: #991b1b'
      };
      const labels = {
        'Pending': 'โณ ููุฏ ุงูุงูุชุธุงุฑ',
        'In Progress': '๐ ููุฏ ุงูุชูููุฐ',
        'Completed': 'โ ููุชููุฉ',
        'Cancelled': 'โ ููุบูุฉ'
      };
      return `<span class="status-badge" style="${colors[status] || ''}">${labels[status] || status}</span>`;
    }
    
    function getInvoiceStatusBadge(status) {
      const colors = {
        'Pending': 'background: #fef3c7; color: #92400e',
        'Paid': 'background: #d1fae5; color: #065f46',
        'Overdue': 'background: #fee2e2; color: #991b1b',
        'Cancelled': 'background: #e5e7eb; color: #374151'
      };
      const labels = {
        'Pending': 'โณ ููุฏ ุงูุงูุชุธุงุฑ',
        'Paid': 'โ ูุฏููุนุฉ',
        'Overdue': 'โ๏ธ ูุชุฃุฎุฑุฉ',
        'Cancelled': 'โ ููุบูุฉ'
      };
      return `<span class="status-badge" style="${colors[status] || ''}">${labels[status] || status}</span>`;
    }
    
    function openMaintenanceModal() {
      document.getElementById('maintenance-form').reset();
      document.getElementById('maintenance-date').value = new Date().toISOString().split('T')[0];
      document.getElementById('maintenance-modal').classList.add('active');
    }
    
    let currentEditMaintenance = null;
    
    function editMaintenance(id) {
      const maintenance = allData.find(d => d.__backendId === id);
      if (!maintenance) return;
      
      currentEditMaintenance = maintenance;
      
      document.getElementById('maintenance-location').value = maintenance.location || '';
      document.getElementById('maintenance-unit').value = maintenance.unit_number || '';
      document.getElementById('maintenance-type').value = maintenance.maintenance_type || '';
      document.getElementById('maintenance-description').value = maintenance.description || '';
      document.getElementById('maintenance-date').value = maintenance.maintenance_date || '';
      document.getElementById('maintenance-status').value = maintenance.maintenance_status || 'Pending';
      document.getElementById('maintenance-assigned').value = maintenance.assigned_to || '';
      document.getElementById('maintenance-cost').value = maintenance.cost || '';
      document.getElementById('maintenance-notes').value = maintenance.notes || '';
      
      document.getElementById('maintenance-modal').classList.add('active');
    }
    
    async function saveMaintenance(event) {
      event.preventDefault();
      
      if (allData.filter(d => d.type === 'maintenance').length >= 999 && !currentEditMaintenance) {
        showToast("ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู ูู ุทูุจุงุช ุงูุตูุงูุฉ (999)");
        return;
      }
      
      const form = event.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
      
      const maintenanceData = {
        type: 'maintenance',
        location: document.getElementById('maintenance-location').value,
        unit_number: document.getElementById('maintenance-unit').value,
        maintenance_type: document.getElementById('maintenance-type').value,
        description: document.getElementById('maintenance-description').value,
        maintenance_date: document.getElementById('maintenance-date').value,
        maintenance_status: document.getElementById('maintenance-status').value,
        assigned_to: document.getElementById('maintenance-assigned').value || null,
        cost: document.getElementById('maintenance-cost').value ? parseFloat(document.getElementById('maintenance-cost').value) : null,
        notes: document.getElementById('maintenance-notes').value || null,
        timestamp: new Date().toISOString()
      };
      
      let result;
      if (currentEditMaintenance) {
        maintenanceData.__backendId = currentEditMaintenance.__backendId;
        result = await window.dataSdk.update(maintenanceData);
      } else {
        result = await window.dataSdk.create(maintenanceData);
      }
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'ุญูุธ';
      
      if (result.isOk) {
        showToast(currentEditMaintenance ? 'ุชู ุชุญุฏูุซ ุทูุจ ุงูุตูุงูุฉ ุจูุฌุงุญ' : 'ุชู ุฅุถุงูุฉ ุทูุจ ุงูุตูุงูุฉ ุจูุฌุงุญ');
        closeModal('maintenance-modal');
        form.reset();
        currentEditMaintenance = null;
      } else {
        showToast('ูุดู ุญูุธ ุทูุจ ุงูุตูุงูุฉ');
      }
    }
    
    async function deleteMaintenance(id) {
      const maintenance = allData.find(d => d.__backendId === id);
      if (!maintenance) return;
      
      if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุทูุจ ุงูุตูุงูุฉุ')) return;
      
      const result = await window.dataSdk.delete(maintenance);
      
      if (result.isOk) {
        showToast('ุชู ุญุฐู ุทูุจ ุงูุตูุงูุฉ');
      } else {
        showToast('ูุดู ุญุฐู ุทูุจ ุงูุตูุงูุฉ');
      }
    }
    
    let invoiceImageBase64 = null;
    
    function handleInvoiceImage(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (!file.type.startsWith('image/')) {
        showToast('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ููู ุตูุฑุฉ');
        event.target.value = '';
        return;
      }
      
      if (file.size > 5 * 1024 * 1024) {
        showToast('ุญุฌู ุงูุตูุฑุฉ ูุจูุฑ ุฌุฏุงู (ุงูุญุฏ ุงูุฃูุตู 5MB)');
        event.target.value = '';
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        invoiceImageBase64 = e.target.result;
        const preview = document.getElementById('invoice-image-preview');
        const previewImg = document.getElementById('invoice-preview-img');
        previewImg.src = invoiceImageBase64;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(file);
    }
    
    function clearInvoiceImage() {
      invoiceImageBase64 = null;
      document.getElementById('invoice-image').value = '';
      document.getElementById('invoice-image-preview').style.display = 'none';
    }
    
    function viewInvoiceImage(id) {
      const invoice = allData.find(d => d.__backendId === id);
      if (!invoice || !invoice.image) return;
      
      const newWindow = window.open();
      newWindow.document.write(`<html><head><title>ุตูุฑุฉ ุงููุงุชูุฑุฉ</title></head><body style="margin:0;display:flex;justify-content:center;align-items:center;height:100vh;background:#f3f4f6;"><img src="${invoice.image}" style="max-width:90%;max-height:90%;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.3);"></body></html>`);
    }
    
    function openInvoiceModal() {
      document.getElementById('invoice-form').reset();
      invoiceImageBase64 = null;
      document.getElementById('invoice-image-preview').style.display = 'none';
      document.getElementById('invoice-date').value = new Date().toISOString().split('T')[0];
      document.getElementById('invoice-modal').classList.add('active');
    }
    
    let currentEditInvoice = null;
    
    function editInvoice(id) {
      const invoice = allData.find(d => d.__backendId === id);
      if (!invoice) return;
      
      currentEditInvoice = invoice;
      invoiceImageBase64 = invoice.image || null;
      
      document.getElementById('invoice-number').value = invoice.invoice_number || '';
      document.getElementById('invoice-location').value = invoice.location || '';
      document.getElementById('invoice-unit').value = invoice.unit_number || '';
      document.getElementById('invoice-type').value = invoice.invoice_type || '';
      document.getElementById('invoice-amount').value = invoice.amount || '';
      document.getElementById('invoice-date').value = invoice.invoice_date || '';
      document.getElementById('invoice-status').value = invoice.invoice_status || 'Pending';
      document.getElementById('invoice-notes').value = invoice.notes || '';
      
      if (invoiceImageBase64) {
        const preview = document.getElementById('invoice-image-preview');
        const previewImg = document.getElementById('invoice-preview-img');
        previewImg.src = invoiceImageBase64;
        preview.style.display = 'block';
      }
      
      document.getElementById('invoice-modal').classList.add('active');
    }
    
    async function saveInvoice(event) {
      event.preventDefault();
      
      if (allData.filter(d => d.type === 'invoice').length >= 999 && !currentEditInvoice) {
        showToast("ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู ูู ุงูููุงุชูุฑ (999)");
        return;
      }
      
      const form = event.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
      
      const invoiceData = {
        type: 'invoice',
        invoice_number: document.getElementById('invoice-number').value,
        location: document.getElementById('invoice-location').value,
        unit_number: document.getElementById('invoice-unit').value,
        invoice_type: document.getElementById('invoice-type').value,
        amount: parseFloat(document.getElementById('invoice-amount').value),
        invoice_date: document.getElementById('invoice-date').value,
        invoice_status: document.getElementById('invoice-status').value,
        image: invoiceImageBase64 || null,
        notes: document.getElementById('invoice-notes').value || null,
        timestamp: new Date().toISOString()
      };
      
      let result;
      if (currentEditInvoice) {
        invoiceData.__backendId = currentEditInvoice.__backendId;
        result = await window.dataSdk.update(invoiceData);
      } else {
        result = await window.dataSdk.create(invoiceData);
      }
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'ุญูุธ';
      
      if (result.isOk) {
        showToast(currentEditInvoice ? 'ุชู ุชุญุฏูุซ ุงููุงุชูุฑุฉ ุจูุฌุงุญ' : 'ุชู ุฅุถุงูุฉ ุงููุงุชูุฑุฉ ุจูุฌุงุญ');
        closeModal('invoice-modal');
        form.reset();
        invoiceImageBase64 = null;
        document.getElementById('invoice-image-preview').style.display = 'none';
        currentEditInvoice = null;
      } else {
        showToast('ูุดู ุญูุธ ุงููุงุชูุฑุฉ');
      }
    }
    
    async function deleteInvoice(id) {
      const invoice = allData.find(d => d.__backendId === id);
      if (!invoice) return;
      
      if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงููุงุชูุฑุฉุ')) return;
      
      const result = await window.dataSdk.delete(invoice);
      
      if (result.isOk) {
        showToast('ุชู ุญุฐู ุงููุงุชูุฑุฉ');
      } else {
        showToast('ูุดู ุญุฐู ุงููุงุชูุฑุฉ');
      }
    }
    
    function renderPOS() {
      const posRecords = allData.filter(d => d.type === 'pos');
      const tbody = document.getElementById('pos-body');
      
      if (posRecords.length === 0) {
        tbody.innerHTML = '<tr><td colspan="12" style="text-align: center; color: #6b7280;">ูุง ุชูุฌุฏ ุฏูุนุงุช</td></tr>';
        return;
      }
      
      posRecords.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      
      tbody.innerHTML = posRecords.map(pos => {
        const capital = pos.capital || 0;
        const tenantPrice = pos.tenant_price || 0;
        const invoicesDeduction = pos.invoices_deduction || 0;
        const profit = tenantPrice - capital - invoicesDeduction;
        
        const paidBadge = pos.is_paid ? 
          '<span class="status-badge" style="background: #d1fae5; color: #065f46;">โ ูุฏููุนุฉ</span>' : 
          '<span class="status-badge" style="background: #fee2e2; color: #991b1b;">โ ุบูุฑ ูุฏููุนุฉ</span>';
        
        const profitColor = profit >= 0 ? '#059669' : '#dc2626';
        
        return `
        <tr>
          <td>${pos.checkin_date}</td>
          <td style="max-width: 200px; word-wrap: break-word;">${pos.unit_address}</td>
          <td>${pos.phone_number}</td>
          <td><strong>${capital.toFixed(2)} $</strong></td>
          <td><strong>${tenantPrice.toFixed(2)} $</strong></td>
          <td><strong style="color: #f59e0b;">${invoicesDeduction.toFixed(2)} $</strong></td>
          <td><strong style="color: ${profitColor}; font-size: 1.125rem;">${profit.toFixed(2)} $</strong></td>
          <td>${paidBadge}</td>
          <td>${pos.payment_date || '-'}</td>
          <td style="max-width: 150px; word-wrap: break-word;">${pos.notes || '-'}</td>
          <td>
            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
              ${pos.is_paid ? `<button class="btn-success" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="downloadInvoice('${pos.__backendId}')">๐ ุชุญููู ุงููุงุชูุฑุฉ</button>` : ''}
              ${pos.is_paid ? `<button class="btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="sendInvoice('${pos.__backendId}')">๐ง ุฅุฑุณุงู ูููุณุชุฃุฌุฑ</button>` : ''}
              <button class="btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="editPOS('${pos.__backendId}')">ุชุนุฏูู</button>
              <button class="btn-danger" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="deletePOS('${pos.__backendId}')">ุญุฐู</button>
            </div>
          </td>
        </tr>
      `}).join('');
    }
    
    function updatePOSProfit() {
      const capital = parseFloat(document.getElementById('pos-capital').value) || 0;
      const tenantPrice = parseFloat(document.getElementById('pos-tenant-price').value) || 0;
      const invoicesDeduction = parseFloat(document.getElementById('pos-invoices-deduction').value) || 0;
      const profit = tenantPrice - capital - invoicesDeduction;
      
      const profitInput = document.getElementById('pos-profit');
      profitInput.value = profit.toFixed(2) + ' $';
      profitInput.style.color = profit >= 0 ? '#059669' : '#dc2626';
    }
    
    function updatePaymentDate() {
      const isPaid = document.getElementById('pos-paid').value === 'paid';
      const paymentDateGroup = document.getElementById('pos-payment-date-group');
      const paymentDateInput = document.getElementById('pos-payment-date');
      
      if (isPaid) {
        paymentDateGroup.style.display = 'block';
        if (!paymentDateInput.value) {
          paymentDateInput.value = new Date().toISOString().split('T')[0];
        }
        paymentDateInput.required = true;
      } else {
        paymentDateGroup.style.display = 'none';
        paymentDateInput.value = '';
        paymentDateInput.required = false;
      }
    }
    
    function updatePOSUnits() {
      const location = document.getElementById('pos-location').value;
      const unitSelect = document.getElementById('pos-unit');
      
      // Get all units
      const units = allData.filter(d => d.type === 'unit');
      
      // Filter by location if selected
      let filteredUnits = units;
      if (location) {
        filteredUnits = units.filter(u => u.location === location);
      }
      
      // Sort by unit number
      filteredUnits.sort((a, b) => {
        if (a.location !== b.location) return a.location.localeCompare(b.location);
        return a.unit_number.localeCompare(b.unit_number);
      });
      
      // Clear and populate unit select
      unitSelect.innerHTML = '<option value="">ุงุฎุชุฑ ุงูุดูุฉ</option>';
      filteredUnits.forEach(unit => {
        const option = document.createElement('option');
        option.value = unit.__backendId;
        option.textContent = `${unit.location} - ${unit.unit_number}`;
        unitSelect.appendChild(option);
      });
      
      // Clear address and phone when location changes
      document.getElementById('pos-address').value = '';
      document.getElementById('pos-phone').value = '';
    }
    
    function fillPOSFromUnit() {
      const unitId = document.getElementById('pos-unit').value;
      if (!unitId) {
        document.getElementById('pos-address').value = '';
        document.getElementById('pos-phone').value = '';
        return;
      }
      
      const unit = allData.find(d => d.__backendId === unitId);
      if (!unit) return;
      
      // Fill address (can be unit address or location + unit number)
      const address = unit.unit_address || `${unit.location} - ${unit.unit_number}`;
      document.getElementById('pos-address').value = address;
      
      // Fill phone if available
      if (unit.tenant_phone) {
        document.getElementById('pos-phone').value = unit.tenant_phone;
      }
    }
    
    function openPOSModal() {
      document.getElementById('pos-form').reset();
      currentEditPOS = null;
      document.getElementById('pos-checkin-date').value = new Date().toISOString().split('T')[0];
      document.getElementById('pos-profit').value = '0.00 $';
      document.getElementById('pos-invoices-deduction').value = '0';
      document.getElementById('pos-payment-date-group').style.display = 'none';
      
      // Update units list
      updatePOSUnits();
      
      document.getElementById('pos-modal').classList.add('active');
    }
    
    let currentEditPOS = null;
    
    function editPOS(id) {
      const pos = allData.find(d => d.__backendId === id);
      if (!pos) return;
      
      currentEditPOS = pos;
      
      document.getElementById('pos-checkin-date').value = pos.checkin_date || '';
      document.getElementById('pos-location').value = pos.location || '';
      
      // Update units list and try to find matching unit
      updatePOSUnits();
      const units = allData.filter(d => d.type === 'unit');
      const matchingUnit = units.find(u => u.location === pos.location && u.unit_number === pos.unit_number);
      if (matchingUnit) {
        document.getElementById('pos-unit').value = matchingUnit.__backendId;
      } else {
        document.getElementById('pos-unit').value = '';
      }
      
      document.getElementById('pos-address').value = pos.unit_address || '';
      document.getElementById('pos-phone').value = pos.phone_number || '';
      document.getElementById('pos-capital').value = pos.capital || '';
      document.getElementById('pos-tenant-price').value = pos.tenant_price || '';
      document.getElementById('pos-invoices-deduction').value = pos.invoices_deduction || '0';
      document.getElementById('pos-paid').value = pos.is_paid ? 'paid' : 'unpaid';
      document.getElementById('pos-payment-date').value = pos.payment_date || '';
      document.getElementById('pos-notes').value = pos.notes || '';
      
      updatePOSProfit();
      updatePaymentDate();
      
      document.getElementById('pos-modal').classList.add('active');
    }
    
    async function savePOS(event) {
      event.preventDefault();
      
      if (allData.filter(d => d.type === 'pos').length >= 999 && !currentEditPOS) {
        showToast("ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู ูู ุงูุฏูุนุงุช (999)");
        return;
      }
      
      const form = event.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
      
      const isPaid = document.getElementById('pos-paid').value === 'paid';
      const paymentDate = isPaid ? document.getElementById('pos-payment-date').value : null;
      
      // Get unit details from selected unit
      const unitId = document.getElementById('pos-unit').value;
      let unitNumber = '';
      if (unitId) {
        const selectedUnit = allData.find(d => d.__backendId === unitId);
        if (selectedUnit) {
          unitNumber = selectedUnit.unit_number;
        }
      }
      // If no unit selected or not found, use the value as-is (for backward compatibility)
      if (!unitNumber) {
        const unitSelect = document.getElementById('pos-unit');
        const selectedOption = unitSelect.options[unitSelect.selectedIndex];
        if (selectedOption && selectedOption.textContent) {
          // Extract unit number from "location - unit_number" format
          const parts = selectedOption.textContent.split(' - ');
          if (parts.length > 1) {
            unitNumber = parts[1];
          }
        }
        if (!unitNumber) {
          unitNumber = unitId; // Fallback
        }
      }
      
      const posData = {
        type: 'pos',
        checkin_date: document.getElementById('pos-checkin-date').value,
        location: document.getElementById('pos-location').value,
        unit_number: unitNumber,
        unit_address: document.getElementById('pos-address').value,
        phone_number: document.getElementById('pos-phone').value,
        capital: parseFloat(document.getElementById('pos-capital').value) || 0,
        tenant_price: parseFloat(document.getElementById('pos-tenant-price').value) || 0,
        invoices_deduction: parseFloat(document.getElementById('pos-invoices-deduction').value) || 0,
        is_paid: isPaid,
        payment_date: paymentDate,
        notes: document.getElementById('pos-notes').value || null,
        timestamp: new Date().toISOString()
      };
      
      let result;
      if (currentEditPOS) {
        posData.__backendId = currentEditPOS.__backendId;
        result = await window.dataSdk.update(posData);
      } else {
        result = await window.dataSdk.create(posData);
      }
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'ุญูุธ';
      
      if (result.isOk) {
        // If payment is marked as paid, create invoice automatically
        if (isPaid && paymentDate) {
          createInvoiceFromPOS(posData);
        }
        showToast(currentEditPOS ? 'ุชู ุชุญุฏูุซ ุงูุฏูุนุฉ ุจูุฌุงุญ' : 'ุชู ุฅุถุงูุฉ ุงูุฏูุนุฉ ุจูุฌุงุญ');
        closeModal('pos-modal');
        form.reset();
        currentEditPOS = null;
      } else {
        showToast('ูุดู ุญูุธ ุงูุฏูุนุฉ');
      }
    }
    
    async function deletePOS(id) {
      const pos = allData.find(d => d.__backendId === id);
      if (!pos) return;
      
      if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงูุฏูุนุฉุ')) return;
      
      const result = await window.dataSdk.delete(pos);
      
      if (result.isOk) {
        showToast('ุชู ุญุฐู ุงูุฏูุนุฉ');
      } else {
        showToast('ูุดู ุญุฐู ุงูุฏูุนุฉ');
      }
    }
    
    function createInvoiceFromPOS(posData) {
      // Create invoice number
      const invoiceNumber = 'INV-' + new Date().getTime();
      
      // Calculate totals
      const capital = posData.capital || 0;
      const tenantPrice = posData.tenant_price || 0;
      const invoicesDeduction = posData.invoices_deduction || 0;
      const profit = tenantPrice - capital - invoicesDeduction;
      
      // Store invoice data in posData for later use
      posData.invoice_number = invoiceNumber;
      posData.invoice_total = tenantPrice;
      posData.invoice_profit = profit;
    }
    
    function downloadInvoice(id) {
      const pos = allData.find(d => d.__backendId === id);
      if (!pos || !pos.is_paid) {
        showToast('ุงูุฏูุนุฉ ุบูุฑ ูุฏููุนุฉ');
        return;
      }
      
      const capital = pos.capital || 0;
      const tenantPrice = pos.tenant_price || 0;
      const invoicesDeduction = pos.invoices_deduction || 0;
      const profit = tenantPrice - capital - invoicesDeduction;
      const invoiceNumber = pos.invoice_number || 'INV-' + pos.__backendId;
      
      // Create invoice HTML
      const invoiceHTML = `
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ูุงุชูุฑุฉ ${invoiceNumber}</title>
  <style>
    @media print {
      body { margin: 0; }
      .no-print { display: none; }
    }
    body {
      font-family: 'Arial', sans-serif;
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
      background: white;
    }
    .header {
      text-align: center;
      border-bottom: 3px solid #3b82f6;
      padding-bottom: 1rem;
      margin-bottom: 2rem;
    }
    .invoice-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
    }
    .info-box {
      background: #f3f4f6;
      padding: 1rem;
      border-radius: 8px;
      flex: 1;
      margin: 0 0.5rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 2rem 0;
    }
    th, td {
      padding: 1rem;
      text-align: right;
      border-bottom: 1px solid #e5e7eb;
    }
    th {
      background: #f3f4f6;
      font-weight: bold;
    }
    .total-row {
      background: #f3f4f6;
      font-weight: bold;
      font-size: 1.125rem;
    }
    .footer {
      margin-top: 3rem;
      text-align: center;
      color: #6b7280;
      border-top: 2px solid #e5e7eb;
      padding-top: 1rem;
    }
    .btn {
      padding: 0.75rem 1.5rem;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 0.5rem;
      font-size: 1rem;
    }
    .btn:hover {
      background: #2563eb;
    }
  </style>
</head>
<body>
  <div class="no-print" style="text-align: center; margin-bottom: 2rem;">
    <button class="btn" onclick="window.print()">๐จ๏ธ ุทุจุงุนุฉ</button>
    <button class="btn" onclick="window.close()">โ ุฅุบูุงู</button>
  </div>
  
  <div class="header">
    <h1 style="color: #1f2937; margin: 0;">ูุงุชูุฑุฉ ุฅูุฌุงุฑ</h1>
    <p style="color: #6b7280; margin: 0.5rem 0;">Invoice Number: ${invoiceNumber}</p>
  </div>
  
  <div class="invoice-info">
    <div class="info-box">
      <h3 style="margin-top: 0; color: #1f2937;">ูุนูููุงุช ุงููุณุชุฃุฌุฑ</h3>
      <p><strong>ุฑูู ุงูุฌูุงู:</strong> ${pos.phone_number}</p>
      <p><strong>ุนููุงู ุงูุดูุฉ:</strong> ${pos.unit_address}</p>
      <p><strong>ุงููููุน:</strong> ${pos.location}</p>
      <p><strong>ุฑูู ุงูุดูุฉ:</strong> ${pos.unit_number}</p>
    </div>
    <div class="info-box">
      <h3 style="margin-top: 0; color: #1f2937;">ูุนูููุงุช ุงููุงุชูุฑุฉ</h3>
      <p><strong>ุชุงุฑูุฎ ุงูุฏุฎูู:</strong> ${pos.checkin_date}</p>
      <p><strong>ุชุงุฑูุฎ ุงูุฏูุน:</strong> ${pos.payment_date}</p>
      <p><strong>ุญุงูุฉ ุงูุฏูุน:</strong> โ ูุฏููุนุฉ</p>
    </div>
  </div>
  
  <table>
    <thead>
      <tr>
        <th>ุงููุตู</th>
        <th>ุงููุจูุบ ($)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>ุณุนุฑ ุงููุณุชุฃุฌุฑ</td>
        <td>${tenantPrice.toFixed(2)}</td>
      </tr>
      <tr>
        <td>ุฑุฃุณ ุงููุงู</td>
        <td style="color: #dc2626;">-${capital.toFixed(2)}</td>
      </tr>
      ${invoicesDeduction > 0 ? `
      <tr>
        <td>ุงูููุงุชูุฑ ุงููุฎุตููุฉ</td>
        <td style="color: #dc2626;">-${invoicesDeduction.toFixed(2)}</td>
      </tr>
      ` : ''}
      <tr class="total-row">
        <td>ูููุฉ ุงูุฑุจุญ</td>
        <td style="color: ${profit >= 0 ? '#059669' : '#dc2626'}; font-size: 1.25rem;">${profit.toFixed(2)} $</td>
      </tr>
    </tbody>
  </table>
  
  ${pos.notes ? `
  <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; margin-top: 2rem;">
    <h3 style="margin-top: 0; color: #1f2937;">ููุงุญุธุงุช:</h3>
    <p style="color: #4b5563;">${pos.notes}</p>
  </div>
  ` : ''}
  
  <div class="footer">
    <p>ุดูุฑุงู ูุงุณุชุฎุฏุงูู ูุธุงู ุฅุฏุงุฑุฉ ุงูุดูู</p>
    <p style="font-size: 0.875rem;">ุชู ุฅูุดุงุก ูุฐู ุงููุงุชูุฑุฉ ุชููุงุฆูุงู</p>
  </div>
</body>
</html>
      `;
      
      // Create blob and download
      const blob = new Blob([invoiceHTML], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Invoice_${invoiceNumber}_${pos.checkin_date}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showToast('ุชู ุชุญููู ุงููุงุชูุฑุฉ ุจูุฌุงุญ');
    }
    
    function sendInvoice(id) {
      const pos = allData.find(d => d.__backendId === id);
      if (!pos || !pos.is_paid) {
        showToast('ุงูุฏูุนุฉ ุบูุฑ ูุฏููุนุฉ');
        return;
      }
      
      if (!pos.phone_number) {
        showToast('ุฑูู ุงูุฌูุงู ุบูุฑ ูุชููุฑ');
        return;
      }
      
      // Create invoice summary for WhatsApp
      const capital = pos.capital || 0;
      const tenantPrice = pos.tenant_price || 0;
      const invoicesDeduction = pos.invoices_deduction || 0;
      const profit = tenantPrice - capital - invoicesDeduction;
      const invoiceNumber = pos.invoice_number || 'INV-' + pos.__backendId;
      
      const message = `ูุงุชูุฑุฉ ุฅูุฌุงุฑ - ${invoiceNumber}

๐ ุงููููุน: ${pos.location}
๐ ุงูุดูุฉ: ${pos.unit_number}
๐ฑ ุฑูู ุงูุฌูุงู: ${pos.phone_number}
๐ ุชุงุฑูุฎ ุงูุฏุฎูู: ${pos.checkin_date}
โ ุชุงุฑูุฎ ุงูุฏูุน: ${pos.payment_date}

๐ฐ ุงูุชูุงุตูู:
ุณุนุฑ ุงููุณุชุฃุฌุฑ: ${tenantPrice.toFixed(2)} $
ุฑุฃุณ ุงููุงู: ${capital.toFixed(2)} $
${invoicesDeduction > 0 ? `ุงูููุงุชูุฑ ุงููุฎุตููุฉ: ${invoicesDeduction.toFixed(2)} $\n` : ''}
๐ ูููุฉ ุงูุฑุจุญ: ${profit.toFixed(2)} $

โ ุญุงูุฉ ุงูุฏูุน: ูุฏููุนุฉ

ุดูุฑุงู ูุงุณุชุฎุฏุงูู ูุธุงู ุฅุฏุงุฑุฉ ุงูุดูู`;

      // Encode message for WhatsApp
      const encodedMessage = encodeURIComponent(message);
      const whatsappUrl = `https://wa.me/${pos.phone_number.replace(/[^0-9]/g, '')}?text=${encodedMessage}`;
      
      // Open WhatsApp
      window.open(whatsappUrl, '_blank');
      showToast('ุชู ูุชุญ WhatsApp ูุฅุฑุณุงู ุงููุงุชูุฑุฉ');
    }
    
    function showToast(message) {
      const existingToast = document.querySelector('.toast');
      if (existingToast) {
        existingToast.remove();
      }
      
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }
  </script>
 </body>
</html>

